<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panadería Manolos</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f8f8f8; }
    h2 { color: #444; }
    .section { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    label { display: block; margin: 10px 0 5px; }
    input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #218838; }
    img.preview { max-width: 200px; margin-top: 10px; }
    .whatsapp-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #25D366;
      color: white;
      border-radius: 50px;
      padding: 12px 18px;
      font-size: 16px;
      text-decoration: none;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    .whatsapp-button:hover {
      background-color: #1ebe5d;
    }
    .whatsapp-button img {
      width: 24px;
      height: 24px;
      margin-right: 8px;
    }

    /* === Estilos responsivos === */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      .section {
        padding: 15px;
      }
      input, select, textarea, button {
        font-size: 16px;
      }
      button {
        width: 100%;
      }
      .whatsapp-button {
        padding: 10px 14px;
        font-size: 14px;
        bottom: 15px;
        right: 15px;
      }
      .whatsapp-button img {
        width: 20px;
        height: 20px;
      }
      img.preview {
        max-width: 100%;
        height: auto;
      }
    }
  </style>
</head>
<body>

  <h2> 🎂Formulario de Pedido Prueba 1.0 - Panadería Manolos🎂 </h2>

  <form id="cakeForm">

    <!-- Idioma -->
    <div class="section">
      <label for="idioma">🌐 Idioma:</label>
      <select id="idioma" name="idioma" required>
        <option value="es">Español</option>
        <option value="en">English</option>
        <option value="it">Italiano</option>
        <option value="otro">Otro</option>
      </select>
    </div>

    <!-- Modelo vitrina -->
    <div class="section">
      <label for="modelo">🍰 Modelo (vitrina):</label>
      <select id="modelo" name="modelo">
        <option value="Durazno">Durazno</option>
        <option value="Chocolate">Chocolate</option>
        <option value="Mocha">Mocha</option>
        <option value="Caramelo">Caramelo</option>
        <option value="Churros">Churros</option>
      </select>

      <label for="tamanoVitrina">Tamaño:</label>
      <select id="tamanoVitrina" name="tamanoVitrina">
        <option value="6\"">6"</option>
        <option value="8\"">8"</option>
        <option value="10\"">10"</option>
      </select>


      <label for="fecha">🗓 Fecha Pedido:</label>
      <input type="date" name="fecha" id="fecha">

      <label for="fecha">🗓 Fecha de recogida:</label>
      <input type="date" name="fecha" id="fecha">

      <label for="hora">⏰ Hora:</label>
      <input type="time" name="hora" id="hora">

      <label for="entrega">🚚 ¿Cómo deseas recibirlo?</label>
      <select id="entrega" name="entrega" required>
        <option value="">Seleccione</option>
        <option value="Recoger en la pastelería">Recoger en la pastelería</option>
        <option value="Domicilio">Domicilio</option>
      </select>
    </div>

    <!-- Personalización pastel -->
    <div class="section">
      <h3>🍰 Pastel Personalizado</h3>
      <label for="forma">Forma y Tamaño:</label>
      <select id="forma" name="forma">
        <option value="Circular 6\"">Circular 6"</option>
        <option value="Circular 8\"">Circular 8"</option>
        <option value="Circular 10\"">Circular 10"</option>
        <option value="Cuadrado 1/4 Sheet">Cuadrado 1/4 Sheet</option>
        <option value="Rectangular 1/2 Sheet">Rectangular 1/2 Sheet</option>
      </select>

      <label for="tipoMasa">Tipo de Pastel:</label>
      <select id="tipoMasa" name="tipoMasa">
        <option value="Tres Leches Vainilla">Tres Leches / Vainilla</option>
        <option value="Tres Leches Chocolate">Tres Leches / Chocolate</option>
        <option value="Vainilla seco">Vainilla seco</option>
        <option value="Chocolate seco">Chocolate seco</option>
        <option value="Marmolado">Marmolado</option>
        <option value="Mocca">Mocca</option>
        <option value="Maracuya">Maracuyá</option>
        <option value="Otro">Otro</option>
      </select>

      <label for="capas">Capas:</label>
      <input type="number" name="capas" min="1" max="5" placeholder="Ej: 2">

      <label for="rellenos">Rellenos (selección múltiple):</label>
      <select id="rellenos" name="rellenos" multiple size="6">
        <option value="Durazno">Durazno</option>
        <option value="Nuez">Nuez</option>
        <option value="Chocolate Chips">Chocolate Chips</option>
        <option value="Mocca">Mocca</option>
        <option value="Cereza">Cereza</option>
        <option value="Fresa Natural">Fresa Natural</option>
        <option value="Fresa Mermelada">Fresa Mermelada</option>
        <option value="Chocolate Seco">Chocolate Seco</option>
        <option value="Piña Mermelada">Piña Mermelada</option>
        <option value="Caramelo">Caramelo</option>
      </select>

      <label for="mezcla">¿Cómo deseas los rellenos?</label>
      <select id="mezcla" name="mezcla">
        <option value="Mixeado">Mixeado</option>
        <option value="Mitad y Mitad">Mitad y Mitad</option>
      </select>
    </div>

    <!-- Decoración -->
    <div class="section">
      <label for="decoracion">🎨 Detalles de Decoración:</label>
      <textarea id="decoracion" name="decoracion" placeholder="Describe decoraciones, temática o instrucciones específicas"></textarea>

      <label for="mensajePastel">📝 Mensaje en el pastel:</label>
      <input type="text" id="mensajePastel" name="mensajePastel">

      <label for="color">🎨 Colores predominantes:</label>
      <input type="text" id="color" name="color">

      <label for="imagen">📷 Imagen de referencia:</label>
      <input type="file" id="imagen" name="imagen" accept="image/*">
      <img class="preview" id="previewImg" style="display: none;" />
    </div>

<!-- Datos del Cliente -->
<div class="section">
  <label for="nombre">👤 Nombre completo:</label>
  <input type="text" id="nombre" name="nombre" required>

<label for="telefono">📞 Teléfono:</label>
<input type="tel" id="telefono" name="telefono" placeholder="+573001234567" pattern="^\+\d{10,15}$" required>
<small>Incluye el indicativo del país. Ejemplo: +573001234567</small>

  <label for="correo">📧 Correo electrónico:</label>
  <input type="email" id="correo" name="correo" required>

  <div id="direccionSection" style="display:none;">
    <label for="direccion">📍 Dirección:</label>
    <textarea id="direccion" name="direccion" placeholder="Ingresa tu dirección completa para el domicilio"></textarea>
  </div>
</div>

<!-- Envío -->
<div class="section">
  <p>🍾 Al hacer clic en enviar, se generará tu número de orden y se confirmará el pedido a través WhatsApp.</p>
  <button type="submit">✅ Enviar Pedido</button>
</div>

<!-- Botón flotante de WhatsApp -->
<a class="whatsapp-button" href="https://wa.me/573027697351?text=Hola%2C%20necesito%20ayuda%20con%20mi%20pedido%20de%20pastel" target="_blank">
  <img src="https://cdn-icons-png.flaticon.com/512/220/220236.png" alt="WhatsApp"> ¿Necesitas ayuda?
</a>





<script>
  const form = document.getElementById('cakeForm');
  const preview = document.getElementById('previewImg');
  const entregaSelect = document.getElementById('entrega');
  const direccionSection = document.getElementById('direccionSection');

  entregaSelect.addEventListener('change', function () {
    direccionSection.style.display = this.value === 'Domicilio' ? 'block' : 'none';
  });

  document.getElementById('imagen').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    }
  });

  function generarOrden() {
    const letras = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const numeros = Math.floor(1000 + Math.random() * 9000);
    const letra = letras.charAt(Math.floor(Math.random() * letras.length));
    return `ORD-${letra}${numeros}`;
  }

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = new FormData(form);
    const pedido = {};
    formData.forEach((value, key) => {
      if (pedido[key]) {
        if (Array.isArray(pedido[key])) {
          pedido[key].push(value);
        } else {
          pedido[key] = [pedido[key], value];
        }
      } else {
        pedido[key] = value;
      }
    });

    const numeroOrden = generarOrden();

    const resumen = `
🍰 Tipo: ${pedido.modelo || pedido.forma}  
📅 Fecha: ${pedido.fecha} a las ${pedido.hora}  
🚚 Entrega: ${pedido.entrega}${pedido.entrega === 'Domicilio' && pedido.direccion ? ` a ${pedido.direccion}` : ''}  
🎨 Decoración: ${pedido.decoracion || 'Sin detalles'}  
📝 Mensaje: ${pedido.mensajePastel || 'Ninguno'}  
📞 Cliente: ${pedido.nombre} (${pedido.telefono})
`;

    // Correcciones por si hay campos con nombres diferentes
    if (pedido.tipoMasa && !pedido.tipoPastel) pedido.tipoPastel = pedido.tipoMasa;
    if (pedido.color && !pedido.colores) pedido.colores = pedido.color;

    const data = {
      Idioma: pedido.idioma || '',
      ModeloVitrina: pedido.modelo || '',
      TamanoVitrina: pedido.tamano || '',
      FechaRecogida: pedido.fecha || '',
      Hora: pedido.hora || '',
      MetodoEntrega: pedido.entrega || '',
      FormaPastel: pedido.forma || '',
      TipoPastel: pedido.tipoPastel || '',
      Capas: pedido.capas || '',
      Rellenos: Array.isArray(pedido.rellenos) ? pedido.rellenos.join(', ') : (pedido.rellenos || ''),
      MezclaRellenos: pedido.mezcla || '',
      Decoracion: pedido.decoracion || '',
      MensajePastel: pedido.mensajePastel || '',
      ColoresPredominantes: pedido.colores || '',
      ImagenReferencia: preview?.src || '',
      NombreCompleto: pedido.nombre || '',
      Telefono: pedido.telefono || '',
      Correo: pedido.correo || '',
      Direccion: pedido.direccion || '',
      FechaPedido: pedido.fecha || ''
    };

    fetch('https://script.google.com/macros/s/AKfycbz9bgU74HqJXf9LsovIFVmuEvL8cJY1i-36GVxlONbxU0kwk8ayV6cHmusam_6IwVPrcg/exec', {
      method: 'POST',
      body: new URLSearchParams(data)
    })
    .then(response => response.text())
    .then(result => {
      alert(`🎂 Tu pedido ha sido registrado con éxito.\n🧾 Número de orden: ${numeroOrden}\n📦 Tu pedido es:\n${resumen}\n✅ Te confirmaremos por WhatsApp en breve.`);

      const mensaje = `Hola, hice un pedido en la web.%0AMi número de orden es: *${numeroOrden}*%0AMi pedido es:%0A${resumen.replace(/\n/g, '%0A')}%0APor favor confirmen. 🎂`;
      const telefonoWhatsApp = '573027697351';
      window.open(`https://wa.me/${telefonoWhatsApp}?text=${mensaje}`, '_blank');

      form.reset();
      preview.style.display = 'none';
      direccionSection.style.display = 'none';
    })
    .catch(error => {
      alert('❌ Hubo un error al registrar tu pedido. Intenta nuevamente.');
      console.error(error);
    });
  });
</script>
</body>
</html>
