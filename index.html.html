<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panader√≠a Manolos</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f8f8f8; }
    h2 { color: #444; }
    .section { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    label { display: block; margin: 10px 0 5px; }
    input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; transition: background 0.3s ease; }
    button:hover { background: #218838; }
    button:disabled { background: #cccccc; cursor: not-allowed; } /* Estilo para bot√≥n deshabilitado */
    img.preview { max-width: 200px; margin-top: 10px; border-radius: 5px; }
    .whatsapp-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #25D366;
      color: white;
      border-radius: 50px;
      padding: 12px 18px;
      font-size: 16px;
      text-decoration: none;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    .whatsapp-button:hover {
      background-color: #1ebe5d;
    }
    .whatsapp-button img {
      width: 24px;
      height: 24px;
      margin-right: 8px;
    }
    .message {
        padding: 10px;
        margin-top: 10px;
        border-radius: 5px;
        display: none; /* Oculto por defecto */
    }
    .message.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    .message.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    /* === Estilos responsivos === */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      .section {
        padding: 15px;
      }
      input, select, textarea, button {
        font-size: 16px;
      }
      button {
        width: 100%;
      }
      .whatsapp-button {
        padding: 10px 14px;
        font-size: 14px;
        bottom: 15px;
        right: 15px;
      }
      .whatsapp-button img {
        width: 20px;
        height: 20px;
      }
      img.preview {
        max-width: 100%;
        height: auto;
      }
    }
  </style>
</head>
<body>

  <h2> üéÇFormulario de Pedido Prueba 1.0 - Panader√≠a ManolosüéÇ </h2>

  <form id="cakeForm">

    <div class="section">
      <label for="idioma">üåê Idioma:</label>
      <select id="idioma" name="idioma" required>
        <option value="es">Espa√±ol</option>
        <option value="en">English</option>
        <option value="it">Italiano</option>
        <option value="otro">Otro</option>
      </select>
    </div>

    <div class="section">
      <label for="modelo">üç∞ Modelo (vitrina):</label>
      <select id="modelo" name="modelo">
        <option value="Durazno">Durazno</option>
        <option value="Chocolate">Chocolate</option>
        <option value="Mocha">Mocha</option>
        <option value="Caramelo">Caramelo</option>
        <option value="Churros">Churros</option>
      </select>

      <label for="tamanoVitrina">Tama√±o:</label>
      <select id="tamanoVitrina" name="tamanoVitrina">
        <option value="6\"">6"</option>
        <option value="8\"">8"</option>
        <option value="10\"">10"</option>
      </select>

      <label for="fecha">üóì Fecha de recogida:</label>
      <input type="date" name="fecha" id="fecha">

      <label for="hora">‚è∞ Hora:</label>
      <input type="time" name="hora" id="hora">

      <label for="entrega">üöö ¬øC√≥mo deseas recibirlo?</label>
      <select id="entrega" name="entrega" required>
        <option value="">Seleccione</option>
        <option value="Recoger en la pasteler√≠a">Recoger en la pasteler√≠a</option>
        <option value="Domicilio">Domicilio</option>
      </select>
    </div>

    <div class="section">
      <h3>üç∞ Pastel Personalizado</h3>
      <label for="forma">Forma y Tama√±o:</label>
      <select id="forma" name="forma">
        <option value="Circular 6\"">Circular 6"</option>
        <option value="Circular 8\"">Circular 8"</option>
        <option value="Circular 10\"">Circular 10"</option>
        <option value="Cuadrado 1/4 Sheet">Cuadrado 1/4 Sheet</option>
        <option value="Rectangular 1/2 Sheet">Rectangular 1/2 Sheet</option>
      </select>

      <label for="tipoMasa">Tipo de Pastel:</label>
      <select id="tipoMasa" name="tipoMasa">
        <option value="Tres Leches Vainilla">Tres Leches / Vainilla</option>
        <option value="Tres Leches Chocolate">Tres Leches / Chocolate</option>
        <option value="Vainilla seco">Vainilla seco</option>
        <option value="Chocolate seco">Chocolate seco</option>
        <option value="Marmolado">Marmolado</option>
        <option value="Mocca">Mocca</option>
        <option value="Maracuya">Maracuy√°</option>
        <option value="Otro">Otro</option>
      </select>

      <label for="capas">Capas:</label>
      <input type="number" name="capas" min="1" max="5" placeholder="Ej: 2">

      <label for="rellenos">Rellenos (selecci√≥n m√∫ltiple):</label>
      <select id="rellenos" name="rellenos" multiple size="6">
        <option value="Durazno">Durazno</option>
        <option value="Nuez">Nuez</option>
        <option value="Chocolate Chips">Chocolate Chips</option>
        <option value="Mocca">Mocca</option>
        <option value="Cereza">Cereza</option>
        <option value="Fresa Natural">Fresa Natural</option>
        <option value="Fresa Mermelada">Fresa Mermelada</option>
        <option value="Chocolate Seco">Chocolate Seco</option>
        <option value="Pi√±a Mermelada">Pi√±a Mermelada</option>
        <option value="Caramelo">Caramelo</option>
      </select>

      <label for="mezcla">¬øC√≥mo deseas los rellenos?</label>
      <select id="mezcla" name="mezcla">
        <option value="Mixeado">Mixeado</option>
        <option value="Mitad y Mitad">Mitad y Mitad</option>
      </select>
    </div>

    <div class="section">
      <label for="decoracion">üé® Detalles de Decoraci√≥n:</label>
      <textarea id="decoracion" name="decoracion" placeholder="Describe decoraciones, tem√°tica o instrucciones espec√≠ficas"></textarea>

      <label for="mensajePastel">üìù Mensaje en el pastel:</label>
      <input type="text" id="mensajePastel" name="mensajePastel">

      <label for="color">üé® Colores predominantes:</label>
      <input type="text" id="color" name="color">

      <label for="imagen">üì∑ Imagen de referencia:</label>
      <input type="file" id="imagen" name="imagen" accept="image/*">
      <img class="preview" id="previewImg" style="display: none;" />
    </div>

<div class="section">
  <label for="nombre">üë§ Nombre completo:</label>
  <input type="text" id="nombre" name="nombre" required>

<label for="telefono">üìû Tel√©fono:</label>
<input type="tel" id="telefono" name="telefono" placeholder="+57 3001234567" pattern="^\+\d{10,15}$" required>
<small>Incluye el indicativo del pa√≠s. Ejemplo: +57 3001234567</small>

  <label for="correo">üìß Correo electr√≥nico:</label>
  <input type="email" id="correo" name="correo" required>

  <div id="direccionSection" style="display:none;">
    <label for="direccion">üìç Direcci√≥n:</label>
    <textarea id="direccion" name="direccion" placeholder="Ingresa tu direcci√≥n completa para el domicilio"></textarea>
  </div>
</div>

<div class="section">
  <p>üçæ Al hacer clic en enviar, se generar√° tu n√∫mero de orden y se confirmar√° el pedido a trav√©s WhatsApp.</p>
  <button type="submit" id="submitButton">‚úÖ Enviar Pedido</button>
  <div id="formMessage" class="message"></div> </div>

<a class="whatsapp-button" href="https://wa.me/573027697351?text=Hola%2C%20necesito%20ayuda%20con%20mi%20pedido%20de%20pastel" target="_blank">
  <img src="https://cdn-icons-png.flaticon.com/512/220/220236.png" alt="WhatsApp"> ¬øNecesitas ayuda?
</a>

<script>
  const form = document.getElementById('cakeForm');
  const preview = document.getElementById('previewImg');
  const entregaSelect = document.getElementById('entrega');
  const direccionSection = document.getElementById('direccionSection');
  const submitButton = document.getElementById('submitButton');
  const formMessage = document.getElementById('formMessage');

  // Funci√≥n para mostrar mensajes al usuario
  function showMessage(message, type) {
    formMessage.textContent = message;
    formMessage.className = message ${type};
    formMessage.style.display = 'block';
  }

  // Ocultar mensaje al interactuar con el formulario
  form.addEventListener('input', () => {
    formMessage.style.display = 'none';
  });

  // Mostrar/Ocultar direcci√≥n seg√∫n entrega
  entregaSelect.addEventListener('change', function () {
    if (this.value === 'Domicilio') {
      direccionSection.style.display = 'block';
      // Hacer el campo de direcci√≥n requerido si es domicilio
      document.getElementById('direccion').setAttribute('required', 'required');
    } else {
      direccionSection.style.display = 'none';
      // Quitar el requisito si no es domicilio
      document.getElementById('direccion').removeAttribute('required');
    }
  });

  // Vista previa de imagen
  document.getElementById('imagen').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(file);
    } else {
      preview.style.display = 'none'; // Ocultar si no hay archivo
      preview.src = ''; // Limpiar la imagen
    }
  });

  form.addEventListener('submit', async function(e) {
    e.preventDefault(); // Previene el env√≠o tradicional del formulario

    // Validaci√≥n b√°sica antes de enviar
    if (!form.checkValidity()) {
        showMessage('Por favor, completa todos los campos requeridos.', 'error');
        return; // Detiene el env√≠o si la validaci√≥n falla
    }

    submitButton.disabled = true; // Deshabilita el bot√≥n para evitar m√∫ltiples env√≠os
    submitButton.textContent = 'Enviando...'; // Cambia el texto del bot√≥n
    formMessage.style.display = 'none'; // Oculta mensajes anteriores

    const formData = new FormData(form);
    const pedido = {};

    // Construye el objeto de pedido, manejando selecciones m√∫ltiples
    formData.forEach((value, key) => {
      // Si es selecci√≥n m√∫ltiple, lo convertimos en array
      if (key === 'rellenos') {
        if (!pedido[key]) {
          pedido[key] = [];
        }
        pedido[key].push(value);
      } else {
        pedido[key] = value;
      }
    });

    // Generar n√∫mero de orden
    const ordenID = 'ORD-' + Date.now();
    pedido.orden = ordenID;

    // URL de tu Google Apps Script
    // ¬°IMPORTANTE! Aseg√∫rate de que esta URL sea la correcta y que tu Script est√© publicado como "aplicaci√≥n web"
    // con acceso "Cualquier persona" o "Cualquier persona, incluso an√≥nimo" para que funcione.
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwsVHAYWM9vnWwy1qXNuu_gj7jq6HQViRHei96ORXth9h4lfcCVI8qWuhW817pBIQE2/exec'; // ¬°VERIFICA ESTA URL!

    try {
      const response = await fetch(scriptURL, {
        method: 'POST',
        // Si tu Google Script espera un JSON puro (e.g., con JSON.parse(e.postData.contents)),
        // entonces Content-Type debe ser 'application/json' y el body JSON.stringify(pedido)
        headers: {
          'Content-Type': 'text/plain;charset=utf-8', // Este Content-Type es com√∫n para scripts simples de Apps Script
          // 'Content-Type': 'application/json', // Si tu script parsea JSON directamente
        },
        // Cuando usas 'text/plain', el script recibe los datos como una cadena en e.postData.contents
        // y necesitar√°s parsear JSON.stringify(pedido) en el script.
        body: JSON.stringify(pedido)
        // Si tu script espera FormData (para archivos por ejemplo, aunque no estamos enviando el archivo de imagen directamente aqu√≠),
        // no incluyas Content-Type y env√≠a el FormData directamente: body: formData
      });

      if (!response.ok) { // Si la respuesta no es 2xx (ej. 404, 500)
        throw new Error(Error de red o del servidor: ${response.status} - ${response.statusText});
      }

      const data = await response.json(); // Intenta parsear la respuesta como JSON

      if (data.status === 'success') {
        showMessage(üéâ Pedido enviado con √©xito. Tu n√∫mero de orden es: ${ordenID}, 'success');
        form.reset(); // Limpia el formulario
        preview.style.display = 'none'; // Oculta la vista previa de la imagen
        direccionSection.style.display = 'none'; // Oculta la secci√≥n de direcci√≥n
        document.getElementById('direccion').removeAttribute('required'); // Asegura que no sea requerido si se resetea
      } else {
        // Si la respuesta JSON indica un error
        showMessage('Error en el servidor: ' + (data.message || 'Intenta de nuevo. Contacta al soporte si persiste.'), 'error');
      }
    } catch (error) {
      // Captura errores de red, JSON parsing, o errores lanzados
      console.error('Error al enviar el formulario:', error);
      showMessage('Ocurri√≥ un error al enviar el pedido. Por favor, revisa tu conexi√≥n e int√©ntalo de nuevo. Si el problema persiste, cont√°ctanos.', 'error');
    } finally {
      submitButton.disabled = false; // Habilita el bot√≥n de nuevo
      submitButton.textContent = '‚úÖ Enviar Pedido'; // Restaura el texto del bot√≥n
    }
  });
</script>
</body>
</html>
