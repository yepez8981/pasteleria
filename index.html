<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-translate-key="pageTitle">Manoloâ€™s Bakery</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f8f8f8; }
    h2 { color: #444; }
    .section { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    label { display: block; margin: 10px 0 5px; }
    input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
    button { background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #218838; }
    img.preview { max-width: 200px; margin-top: 10px; border-radius: 5px; }
    .whatsapp-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #25D366;
      color: white;
      border-radius: 50px;
      padding: 12px 18px;
      font-size: 16px;
      text-decoration: none;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    .whatsapp-button:hover {
      background-color: #1ebe5d;
    }
    .whatsapp-button img {
      width: 24px;
      height: 24px;
      margin-right: 8px;
    }

    @media (max-width: 600px) {
      body { padding: 10px; }
      .section { padding: 15px; }
      input, select, textarea, button { font-size: 16px; }
      button { width: 100%; }
      .whatsapp-button { padding: 10px 14px; font-size: 14px; bottom: 15px; right: 15px; }
      .whatsapp-button img { width: 20px; height: 20px; }
      img.preview { max-width: 100%; height: auto; }
    }
    
    /* CorrecciÃ³n para inputs de fecha y hora en mÃ³viles Iphone Safari y Google Chrome */
input[type="date"],
input[type="time"] {
  max-width: 100%;
  width: 100%;
  box-sizing: border-box;
  -webkit-appearance: none;
  appearance: none;
  font-size: 16px;
}
  </style>
</head>
<body>

  <h2 data-translate-key="formHeading"> ğŸ‚Manoloâ€™s BakeryğŸ‚ </h2>

  <form id="formPedido">
    <div class="section">
      <label for="idioma" data-translate-key="labelIdioma">ğŸŒ Idioma:</label>
      <select id="idioma" name="idioma" required>
        <option value="es" data-translate-key="optionEspaÃ±ol">EspaÃ±ol</option>
        <option value="en" data-translate-key="optionEnglish">InglÃ©s</option>
        <option value="it" data-translate-key="optionItaliano">Italiano</option>
        <option value="otro" data-translate-key="optionOtro">Otro</option>
      </select>
    </div>

    <div class="section">
      <label for="modelo" data-translate-key="labelModeloVitrina">ğŸ° Modelo (vitrina):</label>
      <select id="modelo" name="modelo">
        <option value="" data-translate-key="optionShowcaseDefault">-- Elija un modelo o personalice abajo --</option>
        <option value="Durazno" data-translate-key="optionDurazno">Durazno</option>
        <option value="Chocolate" data-translate-key="optionChocolate">Chocolate</option>
        <option value="Mocha" data-translate-key="optionMocha">Mocha</option>
        <option value="Caramelo" data-translate-key="optionCaramelo">Caramelo</option>
        <option value="Churros" data-translate-key="optionChurros">Churros</option>
      </select>

      <label for="tamanoVitrina" data-translate-key="labelTamanoVitrina">TamaÃ±o:</label>
      <select id="tamanoVitrina" name="tamanoVitrina">
        <option value="" data-translate-key="optionTamanoVitrinaDefault">--</option>
        <option value="6\"">6"</option>
        <option value="8\"">8"</option>
        <option value="10\"">10"</option>
      </select>
 <!-- Mensaje para tamaÃ±os de tortas de vitrina personalizado -->
<div id="infoTamanoVitrina" style="display: none; margin-top: 8px; font-size: 0.9em; color: #2E7D32; padding: 8px; background-color: #E8F5E9; border-radius: 4px;"></div>


      <label for="fecha" data-translate-key="labelFechaPedido">ğŸ—“ Fecha Pedido:</label>
      <input type="date" name="fecha" id="fecha">

      <label for="fechaRecogida" data-translate-key="labelFechaRecogida">ğŸ—“ Fecha de recogida:</label>
      <input type="date" name="fechaRecogida" id="fechaRecogida" required>

      <label for="hora" data-translate-key="labelHora">â° Hora recogida/entrega:</label>
      <input type="time" name="hora" id="hora" required>

      <label for="entrega" data-translate-key="labelEntrega">ğŸšš Â¿CÃ³mo deseas recibirlo?</label>
      <select id="entrega" name="entrega" required>
        <option value="" data-translate-key="optionSeleccione">Seleccione</option>
        <option value="Recoger en la pastelerÃ­a" data-translate-key="optionRecogerEnPasteleria">Recoger en la pastelerÃ­a</option>
        <option value="Domicilio" data-translate-key="optionDomicilio">Domicilio</option>
      </select>
    </div>

    <div class="section" id="seccionPastelPersonalizado">
      <h3 data-translate-key="headingPastelPersonalizado">ğŸ° Pastel Personalizado</h3>
      <label for="forma" data-translate-key="labelFormaYTamano">Forma y TamaÃ±o:</label>
      <select id="forma" name="forma">
        <option value="" data-translate-key="optionFormaYTamanoDefault">--</option>
        <option value="Circular 6\"" data-translate-key="optionCircular6">Circular 6"</option>
        <option value="Circular 8\"" data-translate-key="optionCircular8">Circular 8"</option>
        <option value="Circular 10\"" data-translate-key="optionCircular10">Circular 10"</option>
        <option value="Cuadrado 1/4 Sheet" data-translate-key="optionCuadrado1_4Sheet">Cuadrado 1/4 Sheet</option>
        <option value="Rectangular 1/2 Sheet" data-translate-key="optionRectangular1_2Sheet">Rectangular 1/2 Sheet</option>
      </select>


            
      <div id="infoTamanoPastel" style="display: none; margin-top: 8px; font-size: 0.9em; color: #2E7D32; padding: 8px; background-color: #E8F5E9; border-radius: 4px;"></div>
<label for="tipoMasa" data-translate-key="labelTipoPastel">Tipo de Pastel:</label>
      <select id="tipoMasa" name="tipoMasa">
        <option value="Tres Leches Vainilla" data-translate-key="optionTresLechesVainilla">Tres Leches / Vainilla</option>
        <option value="Tres Leches Chocolate" data-translate-key="optionTresLechesChocolate">Tres Leches / Chocolate</option>
        <option value="Vainilla seco" data-translate-key="optionVainillaSeco">Vainilla seco</option>
        <option value="Chocolate seco" data-translate-key="optionChocolateSeco">Chocolate seco</option>
        <option value="Marmolado" data-translate-key="optionMarmolado">Marmolado</option>
        <option value="Mocca" data-translate-key="optionMoccaPersonalizado">Mocca</option>
        <option value="Maracuya" data-translate-key="optionMaracuya">MaracuyÃ¡</option>
        <option value="Otro" data-translate-key="optionOtroTipoPastel">Otro</option>
      </select>

      <label for="capas" data-translate-key="labelCapas">Capas:</label>
      <input type="number" name="capas" min="1" max="5" placeholder="Ej: 2" data-translate-key="placeholderCapas">

      <label for="rellenos" data-translate-key="labelRellenos">Rellenos (selecciÃ³n mÃºltiple):</label>
      <select id="rellenos" name="rellenos[]" multiple size="6">
        <option value="Durazno" data-translate-key="optionDurazno">Durazno</option>
        <option value="Nuez" data-translate-key="optionNuez">Nuez</option>
        <option value="Chocolate Chips" data-translate-key="optionChocolateChips">Chocolate Chips</option>
        <option value="Mocca" data-translate-key="optionMoccaPersonalizado">Mocca</option>
        <option value="Cereza" data-translate-key="optionCereza">Cereza</option>
        <option value="Fresa Natural" data-translate-key="optionFresaNatural">Fresa Natural</option>
        <option value="Fresa Mermelada" data-translate-key="optionFresaMermelada">Fresa Mermelada</option>
        <option value="Chocolate Seco" data-translate-key="optionChocolateSecoRelleno">Chocolate Seco</option>
        <option value="PiÃ±a Mermelada" data-translate-key="optionPinaMermelada">PiÃ±a Mermelada</option>
        <option value="Caramelo" data-translate-key="optionCaramelo">Caramelo</option>
      </select>
      <small style="display: block; margin-top: 5px; font-size: 0.85em; color: #666;" data-translate-key="hintMultiSelect">Consejo: En escritorio, mantÃ©n presionada la tecla Ctrl (o Cmd en Mac) para seleccionar varios rellenos.</small>
      <div id="rellenosSeleccionados" style="margin-top: 8px; font-size: 0.9em; color: #555;"></div>

      <div id="seccionMezclaRellenos" style="display: none;">
        <label for="mezcla" data-translate-key="labelMezclaRellenos">Â¿CÃ³mo deseas los rellenos?</label>
        <select id="mezcla" name="mezcla">
          <option value="" data-translate-key="optionMezclaDefault">--</option>
          <option value="Mixeado" data-translate-key="optionMixeado">Mixeado</option>
          <option value="Mitad y Mitad" data-translate-key="optionMitadYMitad">Mitad y Mitad</option>
        </select>
      </div>
    </div>

    <div class="section" id="seccionDecoracion">
      <label for="decoracion" data-translate-key="labelDetallesDecoracion">ğŸ¨ Detalles de DecoraciÃ³n:</label>
      <textarea id="decoracion" name="decoracion" placeholder="Describe decoraciones, temÃ¡tica o instrucciones especÃ­ficas" data-translate-key="placeholderDecoracion"></textarea>

      <label for="mensajePastel" data-translate-key="labelMensajePastel">ğŸ“ Mensaje en el pastel:</label>
      <input type="text" id="mensajePastel" name="mensajePastel">
      <small style="display: block; margin-top: 4px; font-size: 0.85em; color: #666;" data-translate-key="hintMensajePastel">Si lo deseas, indica junto a tu mensaje si este va en la tapa o en la pared del pastel.</small>

      <label for="color" data-translate-key="labelColoresPredominantes">ğŸ¨ Colores predominantes:</label>
      <input type="text" id="color" name="color" >
      <small style="display: block; margin-top: 4px; font-size: 0.85em; color: #666;" data-translate-key="hintColoresPredominantes">Ej: Azul primario, tonos pastel claros, rojo oscuro.</small>

   <label for="imagen" data-translate-key="labelImagenReferencia">ğŸ“· Imagen de referencia:</label>
   <input type="file" id="imagen" name="imagenReferencia" accept="image/*">
   <input type="hidden" name="urlImagen" id="urlImagen">
   <img class="preview" id="previewImg" style="display: none; max-width: 200px; margin-top: 10px;" />
        
    </div>

<div class="section">
  <label for="nombre" data-translate-key="labelNombreCompleto">ğŸ‘¤ Nombre completo:</label>
  <input type="text" id="nombre" name="nombre" required>

<label for="telefono" data-translate-key="labelTelefono">ğŸ“ TelÃ©fono:</label>
<input type="tel" id="telefono" name="telefono" placeholder="+573001234567" data-translate-key="placeholderTelefono" pattern="^\+\d{10,15}$" required>
<small data-translate-key="hintTelefono">Incluye el indicativo del paÃ­s. Ejemplo: +573001234567</small>

  <label for="correo" data-translate-key="labelCorreo">ğŸ“§ Correo electrÃ³nico:</label>
  <input type="email" id="correo" name="correo" required>

  
<label for="comentarios" data-translate-key="labelComentarios">ğŸ’¬ Comentarios/Sugerencias:</label>
<textarea id="comentarios" name="comentarios" rows="4" placeholder="Escribe aquÃ­ tus comentarios o sugerencias..."></textarea>


  <div class="contact-preference-container" style="margin-top: 15px; margin-bottom: 10px;">
    <label data-translate-key="labelMetodoContactoPreferido" style="margin-bottom: 8px; display: block; font-weight: bold;">ğŸ’¬ Â¿CÃ³mo prefieres ser contactado?</label>
    <div style="display: flex; align-items: center; margin-bottom: 5px;">
      <input type="radio" id="contactoWhatsapp" name="metodoContacto" value="whatsapp" checked style="width: auto; margin-right: 8px;">
      <label for="contactoWhatsapp" data-translate-key="optionContactoWhatsapp" style="font-weight: normal; margin: 0;">WhatsApp</label>
    </div>
<div style="display: flex; align-items: center;">
      <input type="radio" id="contactoCorreo" name="metodoContacto" value="correo" style="width: auto; margin-right: 8px;">
      <label for="contactoCorreo" data-translate-key="optionContactoCorreo" style="font-weight: normal; margin: 0;">Correo ElectrÃ³nico</label>
    </div>
  </div>

  <div id="direccionSection" style="display:none;">
    <label for="direccion" data-translate-key="labelDireccion">ğŸ“ DirecciÃ³n:</label>
    <textarea id="direccion" name="direccion" placeholder="Ingresa tu direcciÃ³n completa para el domicilio" data-translate-key="placeholderDireccion"></textarea>
  </div>
</div>

    <div class="section">
  <p id="textoEnvioConfirmacion" data-translate-key="textEnvioConfirmacion">
ğŸ¾ Al hacer clic en ğŸ“ Â¡Quiero este pastel! ğŸ“ , generaremos tu nÃºmero de orden y confirmaremos el pedido por <strong>WhatsApp</strong> o <strong>Correo</strong> segÃºn tu elecciÃ³n.
  </p>
<button id="btnEnviar" type="submit" data-translate-key="buttonEnviarPedido" style="
  background-color: #f8d7e3;
  color: #6b0037;
  border: 1.5px solid #f5b7c2;
  border-radius: 12px;
  padding: 10px 20px;
  font-size: 15px;
  font-family: 'Poppins', sans-serif;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
">
  ğŸ“ Â¡Quiero este pastel! ğŸ“
  </button>
<span id="estadoEnvio" style="margin-left: 10px; display: none; color: #555;">
    â³ Preparando tu pedido dulce...
  </span>
</div>

<style>
  #btnEnviar:hover {
    background-color: #f5b7c2;
    transform: scale(1.03);
  }
</style>
    
<script>
  const radiosMetodo = document.querySelectorAll('input[name="metodoContacto"]');
  const textoEnvio = document.getElementById('textoEnvioConfirmacion');

  radiosMetodo.forEach(radio => {
    radio.addEventListener('change', () => {
      const metodo = document.querySelector('input[name="metodoContacto"]:checked')?.value || '';
      if (metodo === 'whatsapp') {
        textoEnvio.innerHTML = 'ğŸ¾ Al hacer clic en ğŸ“ Â¡Quiero este pastel! ğŸ“ , generaremos tu nÃºmero de orden y confirmaremos el pedido por <strong>WhatsApp</strong>.';
      } else {
        textoEnvio.innerHTML = 'ğŸ¾ Al hacer clic en ğŸ“ Â¡Quiero este pastel! ğŸ“ , generaremos tu nÃºmero de orden y confirmaremos el pedido por <strong>Correo ElectrÃ³nico</strong>.';
      }
    });
  });
</script>

    
<script>
  // Evita que se abra el selector imagen de referencia para fase 2
  document.getElementById('imagen').addEventListener('click', function (e) {
    e.preventDefault(); // No permite que se abra el selector de imagenes
  });
</script>
    
<!-- BOTÃ“N FLOTANTE  -->
      
<script>
  console.log("INICIO DEL SCRIPT TAG EJECUTADO"); 

  const translations = {
  es: {
    pageTitle: "Manoloâ€™s Bakery",
    formHeading: "ğŸ‚Manoloâ€™s BakeryğŸ‚",
    labelIdioma: "ğŸŒ Idioma:",
    optionEspaÃ±ol: "EspaÃ±ol",
    optionEnglish: "InglÃ©s",
    optionItaliano: "Italiano",
    optionOtro: "Otro",
    labelModeloVitrina: "ğŸ° Modelo (vitrina):",
    optionShowcaseDefault: "-- Elija un modelo o personalice abajo --",
    optionDurazno: "Durazno",
    optionChocolate: "Chocolate",
    optionMocha: "Mocha",
    optionCaramelo: "Caramelo",
    optionChurros: "Churros",
    labelTamanoVitrina: "TamaÃ±o:",
    labelFechaPedido: "ğŸ—“ Fecha Pedido:",
    labelFechaRecogida: "ğŸ—“ Fecha de recogida:",
    labelHora: "â° Hora recogida/entrega:",
    labelEntrega: "ğŸšš Â¿CÃ³mo deseas recibirlo?",
    optionSeleccione: "Seleccione",
    optionRecogerEnPasteleria: "Recoger en la pastelerÃ­a",
    optionDomicilio: "Domicilio",
    headingPastelPersonalizado: "ğŸ° Pastel Personalizado",
    labelFormaYTamano: "Forma y TamaÃ±o:",
    optionCircular6: "Circular 6\"",
    optionCircular8: "Circular 8\"",
    optionCircular10: "Circular 10\"",
    optionCuadrado1_4Sheet: "Cuadrado 1/4 Sheet",
    optionRectangular1_2Sheet: "Rectangular 1/2 Sheet",
    labelTipoPastel: "Tipo de Pastel:",
    optionTresLechesVainilla: "Tres Leches / Vainilla",
    optionTresLechesChocolate: "Tres Leches / Chocolate",
    optionVainillaSeco: "Vainilla seco",
    optionChocolateSeco: "Chocolate seco",
    optionMarmolado: "Marmolado",
    optionMoccaPersonalizado: "Mocca",
    optionMaracuya: "MaracuyÃ¡",
    optionOtroTipoPastel: "Otro",
    labelCapas: "Capas:",
    placeholderCapas: "Ej: 2",
    labelRellenos: "Rellenos (selecciÃ³n mÃºltiple):",
    optionNuez: "Nuez",
    optionChocolateChips: "Chocolate Chips",
    optionCereza: "Cereza",
    optionFresaNatural: "Fresa Natural",
    optionFresaMermelada: "Fresa Mermelada",
    optionChocolateSecoRelleno: "Chocolate Seco",
    optionPinaMermelada: "PiÃ±a Mermelada",
    hintMultiSelect: "Consejo: En escritorio, mantÃ©n presionada la tecla Ctrl (o Cmd en Mac) para seleccionar varios rellenos.",
    textNoFillingsSelected: "<em>NingÃºn relleno seleccionado.</em>",
    textCurrentFillingsLabel: "<strong>Rellenos seleccionados:</strong> ",
    labelMezclaRellenos: "Â¿CÃ³mo deseas los rellenos?",
    optionMezclaDefault: "--",
    optionMixeado: "Mixeado",
    optionMitadYMitad: "Mitad y Mitad",
    labelDetallesDecoracion: "ğŸ¨ Detalles de DecoraciÃ³n:",
    placeholderDecoracion: "Describe decoraciones, temÃ¡tica o instrucciones especÃ­ficas",
    labelMensajePastel: "ğŸ“ Mensaje en el pastel:",
    hintMensajePastel: "Si lo deseas, indica junto a tu mensaje si este va en la tapa o en la pared del pastel.",
    labelColoresPredominantes: "ğŸ¨ Colores predominantes:",
    hintColoresPredominantes: "Ej: Azul primario, tonos pastel claros, rojo oscuro.",
    labelImagenReferencia: "ğŸ“· Imagen de referencia:",
    labelNombreCompleto: "ğŸ‘¤ Nombre completo:",
    labelTelefono: "ğŸ“ TelÃ©fono:",
    placeholderTelefono: "+573001234567",
    hintTelefono: "Incluye el indicativo del paÃ­s. Ejemplo: +573001234567",
    labelCorreo: "ğŸ“§ Correo electrÃ³nico:",
    labelMetodoContactoPreferido: "ğŸ’¬ Â¿CÃ³mo prefieres ser contactado?",
    optionContactoWhatsapp: "WhatsApp",
    optionContactoCorreo: "Correo ElectrÃ³nico",
    labelDireccion: "ğŸ“ DirecciÃ³n:",
    placeholderDireccion: "Ingresa tu direcciÃ³n completa para el domicilio",
    textEnvioConfirmacion: "ğŸ¾ Al hacer clic en ğŸ“ Â¡Quiero este pastel! ğŸ“, se generarÃ¡ tu nÃºmero de orden y se confirmarÃ¡ el pedido a travÃ©s WhatsApp.",
    buttonEnviarPedido: "ğŸ“ Â¡Quiero este pastel! ğŸ“",
    textNecesitasAyuda: "Â¿Necesitas ayuda?",
    alertPedidoExito: "ğŸ‚ Tu pedido ha sido registrado con Ã©xito.",
    alertNumeroOrden: "ğŸ§¾ NÃºmero de orden: ",
    alertTuPedidoEs: "ğŸ“¦ Tu pedido es:",
    alertConfirmacionWhatsApp: "âœ… Te confirmaremos por WhatsApp en breve.",
    alertErrorPedido: "âŒ Hubo un error al registrar tu pedido. Intenta nuevamente.",
    resumenTipo: "ğŸ° Tipo:",
    resumenFecha: "ğŸ“… Fecha:",
    resumenHoraConector: "a las",
    resumenEntrega: "ğŸšš Entrega:",
    resumenEntregaDomicilioConector: "a",
    resumenDecoracion: "ğŸ¨ DecoraciÃ³n:",
    resumenDecoracionDefault: "Sin detalles",
    resumenMensaje: "ğŸ“ Mensaje:",
    resumenMensajeDefault: "Ninguno",
    resumenCliente: "ğŸ“ Cliente:",
    resumenMetodoContacto: "ğŸ“ MÃ©todo de contacto:", 
    whatsappHolaPedidoWeb: "Hola, hice un pedido en la web.",
    whatsappMiNumeroOrdenEs: "Mi nÃºmero de orden es:",
    whatsappMiPedidoEs: "Mi pedido es:",
    whatsappPorFavorConfirmen: "Por favor confirmen. ğŸ‚",
    errorRequired: "Este campo es obligatorio.",
    errorWhitespace: "Este campo no puede consistir solo de espacios en blanco.",
    errorInvalidEmail: "Por favor, introduce una direcciÃ³n de correo electrÃ³nico vÃ¡lida.",
    errorInvalidPhone: "Por favor, introduce un nÃºmero de telÃ©fono vÃ¡lido (ej: +1234567890).",
    errorDatePast: "La fecha no puede ser en el pasado.",
    errorDateOrder: "La fecha de recogida debe ser igual o posterior a la fecha del pedido.",
    errorMinLength: "Debe tener al menos {minLength} caracteres.",
    errorMinLength2: "El nombre debe tener al menos 2 caracteres.",
    errorNumberRange: "Debe ser un nÃºmero entre {min} y {max}.",
    errorCapasRange: "El nÃºmero de capas debe ser entre 1 y 5.",
    errorFileTooLarge: "El archivo es demasiado grande. MÃ¡ximo {maxSize}MB.",
    errorInvalidFileType: "Tipo de archivo no vÃ¡lido. Permitidos: {fileTypes}.",
    errorRecogidaAnticipacion: "El pedido debe realizarse con al menos 12 horas de anticipaciÃ³n. Por favor, ajusta la fecha/hora de recogida o contÃ¡ctanos para pedidos urgentes.",
    alertConfirmacionCorreo: "âœ… Te confirmaremos por correo electrÃ³nico en breve.",
    infoCircular8: "Â¡Genial elecciÃ³n! El tamaÃ±o de 8â€ es perfecto para reuniones familiares o con amigos. Rinde aproximadamente para 11 deliciosas porciones."
  },
  en: { // ... (Traducciones EN completas incluyendo optionMezclaDefault: "--") ...
    pageTitle: "Manolos Bakery",
    formHeading: "ğŸ‚Manoloâ€™s BakeryğŸ‚",
    labelIdioma: "ğŸŒ Language:",
    optionEspaÃ±ol: "Spanish",
    optionEnglish: "English",
    optionItaliano: "Italian",
    optionOtro: "Other",
    labelModeloVitrina: "ğŸ° Display Case Model:",
    optionShowcaseDefault: "-- Choose a model or customize below --",
    optionDurazno: "Peach",
    optionChocolate: "Chocolate",
    optionMocha: "Mocha",
    optionCaramelo: "Caramel",
    optionChurros: "Churros",
    labelTamanoVitrina: "Size:",
    labelFechaPedido: "ğŸ—“ Order Date:",
    labelFechaRecogida: "ğŸ—“ Pickup Date:",
    labelHora: "â° Time:",
    labelEntrega: "ğŸšš How do you want to receive it?",
    optionSeleccione: "Select",
    optionRecogerEnPasteleria: "Pick up at the bakery",
    optionDomicilio: "Delivery",
    headingPastelPersonalizado: "ğŸ° Custom Cake",
    labelFormaYTamano: "Shape and Size:",
    optionCircular6: "Circular 6\"",
    optionCircular8: "Circular 8\"",
    optionCircular10: "Circular 10\"",
    optionCuadrado1_4Sheet: "Square 1/4 Sheet",
    optionRectangular1_2Sheet: "Rectangular 1/2 Sheet",
    labelTipoPastel: "Type of Cake:",
    optionTresLechesVainilla: "Tres Leches / Vanilla",
    optionTresLechesChocolate: "Tres Leches / Chocolate",
    optionVainillaSeco: "Dry Vanilla",
    optionChocolateSeco: "Dry Chocolate",
    optionMarmolado: "Marble",
    optionMoccaPersonalizado: "Mocha",
    optionMaracuya: "Passion Fruit",
    optionOtroTipoPastel: "Other",
    labelCapas: "Layers:",
    placeholderCapas: "Ex: 2",
    labelRellenos: "Fillings (multiple selection):",
    optionNuez: "Walnut",
    optionChocolateChips: "Chocolate Chips",
    optionCereza: "Cherry",
    optionFresaNatural: "Fresh Strawberry",
    optionFresaMermelada: "Strawberry Jam",
    optionChocolateSecoRelleno: "Dry Chocolate",
    optionPinaMermelada: "Pineapple Jam",
    hintMultiSelect: "Tip: On desktop, hold Ctrl (or Cmd on Mac) to select multiple fillings.",
    textNoFillingsSelected: "<em>No fillings selected.</em>",
    textCurrentFillingsLabel: "<strong>Selected fillings:</strong> ",
    labelMezclaRellenos: "How do you want the fillings?",
    optionMezclaDefault: "--",
    optionMixeado: "Mixed",
    optionMitadYMitad: "Half and Half",
    labelDetallesDecoracion: "ğŸ¨ Decoration Details:",
    placeholderDecoracion: "Describe decorations, theme, or specific instructions",
    labelMensajePastel: "ğŸ“ Message on the cake:",
    hintMensajePastel: "If you wish, indicate along with your message if it goes on the top or side of the cake.",
    labelColoresPredominantes: "ğŸ¨ Predominant Colors:",
    hintColoresPredominantes: "Ex: Primary blue, light pastel tones, dark red.",
    labelImagenReferencia: "ğŸ“· Reference Image:",
    labelNombreCompleto: "ğŸ‘¤ Full Name:",
    labelTelefono: "ğŸ“ Phone:",
    placeholderTelefono: "+16501234567",
    hintTelefono: "Include country code. Example: +16501234567",
    labelCorreo: "ğŸ“§ Email:",
    labelMetodoContactoPreferido: "ğŸ’¬ How do you prefer to be contacted?",
    optionContactoWhatsapp: "WhatsApp",
    optionContactoCorreo: "Email",
    resumenMetodoContacto: "ğŸ“ Preferred contact method:",
    labelDireccion: "ğŸ“ Address:",
    placeholderDireccion: "Enter your full address for delivery",
    textEnvioConfirmacion: "ğŸ¾ By clicking send, your order number will be generated and the order will be confirmed via WhatsApp.",
    buttonEnviarPedido: "âœ… Send Order",
    textNecesitasAyuda: "Need help?",
    alertPedidoExito: "ğŸ‚ Your order has been successfully registered.",
    alertNumeroOrden: "ğŸ§¾ Order number: ",
    alertTuPedidoEs: "ğŸ“¦ Your order is:",
    alertConfirmacionWhatsApp: "âœ… We will confirm via WhatsApp shortly.",
    alertErrorPedido: "âŒ There was an error registering your order. Try again.",
    resumenTipo: "ğŸ° Type:",
    resumenFecha: "ğŸ“… Date:",
    resumenHoraConector: "at",
    resumenEntrega: "ğŸšš Delivery:",
    resumenEntregaDomicilioConector: "to",
    resumenDecoracion: "ğŸ¨ Decoration:",
    resumenDecoracionDefault: "No details",
    resumenMensaje: "ğŸ“ Message:",
    resumenMensajeDefault: "None",
    resumenCliente: "ğŸ“ Customer:",
    whatsappHolaPedidoWeb: "Hello, I placed an order on the website.",
    whatsappMiNumeroOrdenEs: "My order number is:",
    whatsappMiPedidoEs: "My order is:",
    whatsappPorFavorConfirmen: "Please confirm. ğŸ‚",
    errorRequired: "This field is required.",
    errorWhitespace: "This field cannot consist of only whitespace.",
    errorInvalidEmail: "Please enter a valid email address.",
    errorInvalidPhone: "Please enter a valid phone number (e.g., +1234567890).",
    errorDatePast: "Date cannot be in the past.",
    errorDateOrder: "Pickup date must be on or after the order date.",
    errorMinLength: "Must be at least {minLength} characters.",
    errorMinLength2: "Name must be at least 2 characters.",
    errorNumberRange: "Must be a number between {min} and {max}.",
    errorCapasRange: "Number of layers must be between 1 and 5.",
    errorFileTooLarge: "File is too large. Maximum {maxSize}MB.",
    errorInvalidFileType: "Invalid file type. Allowed: {fileTypes}.",
    errorRecogidaAnticipacion: "The order must be placed at least 12 hours in advance. Please adjust the pickup date/time or contact us for rush orders.",
    alertConfirmacionCorreo: "âœ… We will confirm your request by email shortly.",
    infoCircular8: "Great choice! The 8\" size is perfect for family or friends gatherings. Makes approximately 11 delicious servings."
  },
  it: { // ... (Traducciones IT completas incluyendo optionMezclaDefault: "--") ...
    pageTitle: "Panificio Manolos",
    formHeading: "ğŸ‚Panificio ManoloğŸ‚",
    labelIdioma: "ğŸŒ Lingua:",
    optionEspaÃ±ol: "Spagnolo",
    optionEnglish: "Inglese",
    optionItaliano: "Italiano",
    optionOtro: "Altro",
    labelModeloVitrina: "ğŸ° Modello (vetrina):",
    optionShowcaseDefault: "-- Scegli un modello o personalizza sotto --",
    optionDurazno: "Pesca",
    optionChocolate: "Cioccolato",
    optionMocha: "Moka",
    optionCaramelo: "Caramello",
    optionChurros: "Churros",
    labelTamanoVitrina: "Dimensione:",
    labelFechaPedido: "ğŸ—“ Data Ordine:",
    labelFechaRecogida: "ğŸ—“ Data di ritiro:",
    labelHora: "â° Ora:",
    labelEntrega: "ğŸšš Come desideri riceverlo?",
    optionSeleccione: "Seleziona",
    optionRecogerEnPasteleria: "Ritiro in pasticceria",
    optionDomicilio: "Domicilio",
    headingPastelPersonalizado: "ğŸ° Torta Personalizzata",
    labelFormaYTamano: "Forma e Dimensione:",
    optionCircular6: "Circolare 6\"",
    optionCircular8: "Circolare 8\"",
    optionCircular10: "Circolare 10\"",
    optionCuadrado1_4Sheet: "Quadrata 1/4 Foglio",
    optionRectangular1_2Sheet: "Rettangolare 1/2 Foglio",
    labelTipoPastel: "Tipo di Torta:",
    optionTresLechesVainilla: "Tres Leches / Vaniglia",
    optionTresLechesChocolate: "Tres Leches / Cioccolato",
    optionVainillaSeco: "Vaniglia secca",
    optionChocolateSeco: "Cioccolato secco",
    optionMarmolado: "Marmorizzata",
    optionMoccaPersonalizado: "Moka",
    optionMaracuya: "Frutto della Passione",
    optionOtroTipoPastel: "Altro",
    labelCapas: "Strati:",
    placeholderCapas: "Es: 2",
    labelRellenos: "Ripieni (selezione multipla):",
    optionNuez: "Noce",
    optionChocolateChips: "Gocce di Cioccolato",
    optionCereza: "Ciliegia",
    optionFresaNatural: "Fragola Fresca",
    optionFresaMermelada: "Confettura di Fragole",
    optionChocolateSecoRelleno: "Cioccolato Secco",
    optionPinaMermelada: "Confettura di Ananas",
    hintMultiSelect: "Suggerimento: Su desktop, tieni premuto Ctrl (o Cmd su Mac) per selezionare piÃ¹ ripieni.",
    textNoFillingsSelected: "<em>Nessun ripieno selezionato.</em>",
    textCurrentFillingsLabel: "<strong>Ripieni selezionati:</strong> ",
    labelMezclaRellenos: "Come desideri i ripieni?",
    optionMezclaDefault: "--",
    optionMixeado: "Misti",
    optionMitadYMitad: "MetÃ  e MetÃ ",
    labelDetallesDecoracion: "ğŸ¨ Dettagli Decorazione:",
    placeholderDecoracion: "Descrivi decorazioni, tema o istruzioni specifiche",
    labelMensajePastel: "ğŸ“ Messaggio sulla torta:",
    hintMensajePastel: "Se lo desideri, indica insieme al tuo messaggio se va sulla parte superiore o laterale della torta.",
    labelColoresPredominantes: "ğŸ¨ Colori predominanti:",
    hintColoresPredominantes: "Es: Blu primario, tonalitÃ  pastello chiare, rosso scuro.",
    labelImagenReferencia: "ğŸ“· Immagine di riferimento:",
    labelNombreCompleto: "ğŸ‘¤ Nome completo:",
    labelTelefono: "ğŸ“ Telefono:",
    placeholderTelefono: "+391234567890",
    hintTelefono: "Includi il prefisso internazionale. Esempio: +391234567890",
    labelCorreo: "ğŸ“§ Email:",
    labelMetodoContactoPreferido: "ğŸ’¬ Come preferisci essere contattato?",
    optionContactoWhatsapp: "WhatsApp",
    optionContactoCorreo: "Email",
    resumenMetodoContacto: "ğŸ“ Metodo di contatto preferito:",
    labelDireccion: "ğŸ“ Indirizzo:",
    placeholderDireccion: "Inserisci il tuo indirizzo completo per la consegna",
    textEnvioConfirmacion: "ğŸ¾ Cliccando invia, verrÃ  generato il tuo numero d'ordine e l'ordine verrÃ  confermato tramite WhatsApp.",
    buttonEnviarPedido: "âœ… Invia Ordine",
    textNecesitasAyuda: "Serve aiuto?",
    alertPedidoExito: "ğŸ‚ Il tuo ordine Ã¨ stato registrato con successo.",
    alertNumeroOrden: "ğŸ§¾ Numero d'ordine: ",
    alertTuPedidoEs: "ğŸ“¦ Il tuo ordine Ã¨:",
    alertConfirmacionWhatsApp: "âœ… Confermeremo via WhatsApp a breve.",
    alertErrorPedido: "âŒ Si Ã¨ verificato un errore durante la registrazione del tuo ordine. Riprova.",
    resumenTipo: "ğŸ° Tipo:",
    resumenFecha: "ğŸ“… Data:",
    resumenHoraConector: "alle",
    resumenEntrega: "ğŸšš Consegna:",
    resumenEntregaDomicilioConector: "a",
    resumenDecoracion: "ğŸ¨ Decorazione:",
    resumenDecoracionDefault: "Nessun dettaglio",
    resumenMensaje: "ğŸ“ Messaggio:",
    resumenMensajeDefault: "Nessuno",
    resumenCliente: "ğŸ“ Cliente:",
    whatsappHolaPedidoWeb: "Ciao, ho effettuato un ordine sul sito web.",
    whatsappMiNumeroOrdenEs: "Il mio numero d'ordine Ã¨:",
    whatsappMiPedidoEs: "Il mio ordine Ã¨:",
    whatsappPorFavorConfirmen: "Si prega di confermare. ğŸ‚",
    errorRequired: "Questo campo Ã¨ obbligatorio.",
    errorWhitespace: "Questo campo non puÃ² consistere solo di spazi bianchi.",
    errorInvalidEmail: "Inserisci un indirizzo email valido.",
    errorInvalidPhone: "Inserisci un numero di telefono valido (es: +1234567890).",
    errorDatePast: "La data non puÃ² essere nel passato.",
    errorDateOrder: "La data di ritiro deve essere uguale o successiva alla data dell'ordine.",
    errorMinLength: "Deve contenere almeno {minLength} caratteri.",
    errorMinLength2: "Il nome deve contenere almeno 2 caratteri.",
    errorNumberRange: "Deve essere un numero compreso tra {min} e {max}.",
    errorCapasRange: "Il numero di strati deve essere compreso tra 1 e 5.",
    errorFileTooLarge: "Il file Ã¨ troppo grande. Massimo {maxSize}MB.",
    errorInvalidFileType: "Tipo di file non valido. Consentiti: {fileTypes}.",
    errorRecogidaAnticipacion: "L'ordine deve essere effettuato con almeno 12 ore di anticipo. Si prega di modificare la data/ora di ritiro o di contattarci per ordini urgenti.",
    alertConfirmacionCorreo: "âœ… Confermeremo a breve la tua richiesta via e-mail.",
    infoCircular8: "Ottima scelta! Il formato da 8â€ Ã¨ perfetto per le riunioni di famiglia o con gli amici. Per circa 11 deliziose porzioni."
  }
};

  // --- INICIO LÃ“GICA DE TRADUCCIÃ“N ---
  const idiomaSelect = document.getElementById('idioma');

  function cambiarIdioma(lang) {
    const currentTranslations = translations[lang] || translations.es; 

    document.querySelectorAll('[data-translate-key]').forEach(element => {
      const key = element.getAttribute('data-translate-key');
      const translation = currentTranslations[key];

      if (translation !== undefined) {
        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
          if (element.type === 'submit' || element.type === 'button') {
            element.value = translation;
          } else if (element.placeholder !== undefined && (key.endsWith('Placeholder') || key.startsWith('placeholder') || key.startsWith('hint') )) { // Ajustado para incluir 'hint'
            element.placeholder = translation;
          }
        } else if (element.tagName === 'OPTION') {
          element.innerText = translation;
        } else {
          element.innerHTML = translation; 
        }
      }
    });
    
    if (typeof rellenosSelect !== 'undefined' && rellenosSelect && typeof rellenosSeleccionadosDiv !== 'undefined' && rellenosSeleccionadosDiv) {
        const seleccionados = Array.from(rellenosSelect.selectedOptions).map(option => option.text); 
        if (seleccionados.length > 0) {
            rellenosSeleccionadosDiv.innerHTML = (currentTranslations['textCurrentFillingsLabel'] || translations.es['textCurrentFillingsLabel']) + seleccionados.join(', ');
        } else {
            rellenosSeleccionadosDiv.innerHTML = currentTranslations['textNoFillingsSelected'] || translations.es['textNoFillingsSelected'];
        }
    }
    // Actualizar mensaje de tamaÃ±o si estÃ¡ visible
    if (typeof formaSelect !== 'undefined' && formaSelect && typeof infoTamanoPastelDiv !== 'undefined' && infoTamanoPastelDiv && infoTamanoPastelDiv.style.display === 'block' && formaSelect.value === 'Circular 8"') {
        infoTamanoPastelDiv.innerHTML = currentTranslations.infoCircular8 || translations.es.infoCircular8;
    }
  }

  if (idiomaSelect) {
    idiomaSelect.addEventListener('change', function(event) {
      cambiarIdioma(event.target.value);
    });
  }
  // --- FIN LÃ“GICA DE TRADUCCIÃ“N ---

  const form = document.getElementById('formPedido');
  const preview = document.getElementById('previewImg');
  const entregaSelect = document.getElementById('entrega');
  const direccionSection = document.getElementById('direccionSection');
  const rellenosSelect = document.getElementById('rellenos');
  const rellenosSeleccionadosDiv = document.getElementById('rellenosSeleccionados');
  const seccionMezclaRellenos = document.getElementById('seccionMezclaRellenos');
  const modeloSelect = document.getElementById('modelo');
  const seccionPastelPersonalizado = document.getElementById('seccionPastelPersonalizado');
  const seccionDecoracion = document.getElementById('seccionDecoracion');
  const imagenInput = document.getElementById('imagen');
  const mezclaSelect = document.getElementById('mezcla'); 
  let formaSelect; 
  let infoTamanoPastelDiv; 

  if (entregaSelect) {
    entregaSelect.addEventListener('change', function () {
      if(direccionSection) direccionSection.style.display = this.value === 'Domicilio' ? 'block' : 'none';
    });
  }

  function resetearCamposOpcionales() {
    if (seccionPastelPersonalizado) {
      const camposPersonalizado = seccionPastelPersonalizado.querySelectorAll('input, select, textarea');
      camposPersonalizado.forEach(campo => {
        if (campo.type === 'text' || campo.type === 'number' || campo.type === 'email' || campo.tagName === 'TEXTAREA') {
          campo.value = '';
        } else if (campo.tagName === 'SELECT') {
          if (campo.multiple) {
            Array.from(campo.options).forEach(option => option.selected = false);
            if (campo.id === 'rellenos' && rellenosSelect) { //AÃ±adida verificaciÃ³n
              rellenosSelect.dispatchEvent(new Event('change')); 
            }
          } else {
            campo.selectedIndex = 0;
          }
        }
      });
       if (infoTamanoPastelDiv) { // Ocultar y limpiar el div de info tamaÃ±o pastel
            infoTamanoPastelDiv.style.display = 'none';
            infoTamanoPastelDiv.innerHTML = '';
        }
    }

    if (seccionDecoracion) {
      const camposDecoracion = seccionDecoracion.querySelectorAll('input[type="text"], textarea');
      camposDecoracion.forEach(campo => {
        campo.value = '';
      });
      if (imagenInput) {
        imagenInput.value = ''; 
      }
      if (preview) {
        preview.src = '';
        preview.style.display = 'none'; 
      }
    }
  }

  if (modeloSelect) {
    modeloSelect.addEventListener('change', function() {
      const mostrarPersonalizacion = this.value === "";
      if (seccionPastelPersonalizado) seccionPastelPersonalizado.style.display = mostrarPersonalizacion ? 'block' : 'none';
      if (seccionDecoracion) seccionDecoracion.style.display = mostrarPersonalizacion ? 'block' : 'none';
      
      if (!mostrarPersonalizacion) {
        resetearCamposOpcionales(); 
      }
    });
  }

  if (rellenosSelect) {
    rellenosSelect.addEventListener('change', function() {
      const currentLang = idiomaSelect ? (idiomaSelect.value || 'es') : 'es';
      const T = translations[currentLang] || translations.es;

      const seleccionados = Array.from(this.selectedOptions); // Obtener opciones, no solo texto
      const nombresSeleccionados = seleccionados.map(opt => opt.text);

      if (rellenosSeleccionadosDiv) {
        if (nombresSeleccionados.length > 0) {
          rellenosSeleccionadosDiv.innerHTML = (T['textCurrentFillingsLabel'] || "<strong>Rellenos seleccionados:</strong> ") + nombresSeleccionados.join(', ');
        } else {
          rellenosSeleccionadosDiv.innerHTML = T['textNoFillingsSelected'] || "<em>NingÃºn relleno seleccionado.</em>";
        }
      }

      if (seccionMezclaRellenos) {
        if (nombresSeleccionados.length > 1) {
          seccionMezclaRellenos.style.display = 'block';
        } else {
          seccionMezclaRellenos.style.display = 'none';
          if (mezclaSelect) { 
            mezclaSelect.selectedIndex = 0; 
          }
        }
      }
    });
  }
  
  if (document.getElementById('imagen')) {
    document.getElementById('imagen').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file && preview) {
        const reader = new FileReader();
        reader.onload = function (e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else if (preview) {
        preview.src = '';
        preview.style.display = 'none';
      }
    });
  }

  function generarOrden() {
    const hoy = new Date();
    const anio = hoy.getFullYear();
    const mes = String(hoy.getMonth() + 1).padStart(2, '0');
    const dia = String(hoy.getDate()).padStart(2, '0');
    const fechaAAAAMMDD = `${anio}${mes}${dia}`;
    const aleatorioXXX = String(Math.floor(Math.random() * 1000)).padStart(3, '0');
    return `${fechaAAAAMMDD}-${aleatorioXXX}`;
  }

  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault(); 

      const currentLang = idiomaSelect ? (idiomaSelect.value || 'es') : 'es';
      const T = translations[currentLang] || translations.es;

      const fechaRecogidaVal = document.getElementById('fechaRecogida').value;
      const horaRecogidaVal = document.getElementById('hora').value;

      if (fechaRecogidaVal && horaRecogidaVal) { 
        const dateTimeRecogida = new Date(`${fechaRecogidaVal}T${horaRecogidaVal}`);
        const ahora = new Date();
        const limiteRecogida = new Date(ahora.getTime() + 12 * 60 * 60 * 1000); 

        if (dateTimeRecogida < limiteRecogida) {
          alert(T.errorRecogidaAnticipacion || "El pedido debe realizarse con al menos 12 horas de anticipaciÃ³n...");
          return; 
        }
      } else if (!fechaRecogidaVal || !horaRecogidaVal) {
         // Si los campos son required en HTML, el navegador deberÃ­a prevenir esto.
         // Si no, y quieres validarlo aquÃ­:
         // alert(T.errorRequired || "Por favor, complete fecha y hora de recogida.");
         // return;
      }

      const numeroOrden = generarOrden();
      const formDataToSubmit = new FormData(form); 
      formDataToSubmit.append('NumeroOrden', numeroOrden);
      formDataToSubmit.append('Idioma', idiomaSelect.value || 'es');
      
      // Para el resumen local
      const pedidoParaResumenLocal = {};
      new FormData(form).forEach((value, key) => {
        if (pedidoParaResumenLocal[key]) {
          if (!Array.isArray(pedidoParaResumenLocal[key])) {
            pedidoParaResumenLocal[key] = [pedidoParaResumenLocal[key]];
          }
          pedidoParaResumenLocal[key].push(value);
        } else {
          pedidoParaResumenLocal[key] = value;
        }
      });
       // CorrecciÃ³n para obtener texto de rellenos para el resumen
      if (Array.isArray(pedidoParaResumenLocal.rellenos)) {
        const nombresRellenos = [];
        for (const valorRelleno of pedidoParaResumenLocal.rellenos) {
            const opt = rellenosSelect ? rellenosSelect.querySelector(`option[value="${valorRelleno}"]`) : null;
            if (opt) nombresRellenos.push(opt.textContent); else nombresRellenos.push(valorRelleno);
        }
        pedidoParaResumenLocal.rellenosTexto = nombresRellenos.join(', ');
      } else if (pedidoParaResumenLocal.rellenos) {
        const opt = rellenosSelect ? rellenosSelect.querySelector(`option[value="${pedidoParaResumenLocal.rellenos}"]`) : null;
        pedidoParaResumenLocal.rellenosTexto = opt ? opt.textContent : pedidoParaResumenLocal.rellenos;
      } else {
        pedidoParaResumenLocal.rellenosTexto = '';
      }


      let resumen = `${T.resumenTipo} ${pedidoParaResumenLocal.modelo || pedidoParaResumenLocal.forma || T.resumenDecoracionDefault}\n`;
      resumen += `${T.resumenFecha} ${pedidoParaResumenLocal.fechaRecogida} ${T.resumenHoraConector} ${pedidoParaResumenLocal.hora}\n`;
      resumen += `${T.resumenEntrega} ${pedidoParaResumenLocal.entrega}`;
      if (pedidoParaResumenLocal.entrega === 'Domicilio' && pedidoParaResumenLocal.direccion) {
        resumen += ` ${T.resumenEntregaDomicilioConector} ${pedidoParaResumenLocal.direccion}`;
      }
      resumen += `\n${T.resumenDecoracion} ${pedidoParaResumenLocal.decoracion || T.resumenDecoracionDefault}\n`;
      resumen += `${T.resumenMensaje} ${pedidoParaResumenLocal.mensajePastel || T.resumenMensajeDefault}\n`;
      resumen += `${T.resumenCliente} ${pedidoParaResumenLocal.nombre} (${pedidoParaResumenLocal.telefono})\n`; 

const metodoSeleccionado = document.querySelector('input[name="metodoContacto"]:checked')?.value || '';
const metodoContactoTexto = metodoSeleccionado === 'whatsapp'
  ? (T.optionContactoWhatsapp || 'WhatsApp')
  : (T.optionContactoCorreo || 'Correo ElectrÃ³nico');
  resumen += `${T.resumenMetodoContacto} ${metodoContactoTexto}`;

      
  
fetch('https://script.google.com/macros/s/AKfycbwARD5nwf5De6gUweJ3eqgLio3qo4zW9BTn44yxpYMdAWXXvXq9B2gGf5lMNnjBdN1ztg/exec', {
        method: 'POST',
        body: formDataToSubmit
      })
      .then(response => response.json()) 
      .then(result => {
        if (result.status === "success") {
          console.log("Respuesta del Apps Script:", result);
          let mensajeConfirmacionEspecifico = T.alertConfirmacionWhatsApp; 
          if (pedidoParaResumenLocal.metodoContacto === 'correo') { 
            mensajeConfirmacionEspecifico = T.alertConfirmacionCorreo || "âœ… Te confirmaremos por correo electrÃ³nico en breve.";
          }
          alert(`${T.alertPedidoExito}\n${T.alertNumeroOrden}${numeroOrden}\n${T.alertTuPedidoEs}\n${resumen}\n${mensajeConfirmacionEspecifico}`);

          const mensajeWhatsApp = `${T.whatsappHolaPedidoWeb}%0A${T.whatsappMiNumeroOrdenEs} *${numeroOrden}*%0A${T.whatsappMiPedidoEs}%0A${resumen.replace(/\n/g, '%0A')}%0A${T.whatsappPorFavorConfirmen}`;
          const telefonoWhatsApp = '573027697351';
          window.open(`https://wa.me/${telefonoWhatsApp}?text=${mensajeWhatsApp}`, '_blank');

          form.reset();
          if (preview) {
              preview.src = '';
              preview.style.display = 'none';
          }
          if (direccionSection) direccionSection.style.display = 'none';
          if (modeloSelect) modeloSelect.dispatchEvent(new Event('change')); 
          if (rellenosSelect) rellenosSelect.dispatchEvent(new Event('change'));
        } else {
          console.error("Error del Apps Script:", result.message, result.details || '');
          alert(T.alertErrorPedido + (result.message ? `\nDetalle: ${result.message}` : ''));
        }
      })
      .catch(error => {
        console.error("Error en fetch:", error);
        alert(T.alertErrorPedido);
      });
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM completamente cargado y procesado."); 

    const campoFechaPedido = document.getElementById('fecha');
    if (campoFechaPedido) {
      const hoy = new Date();
      const anio = hoy.getFullYear();
      const mes = String(hoy.getMonth() + 1).padStart(2, '0'); 
      const dia = String(hoy.getDate()).padStart(2, '0');
      const fechaFormateada = `${anio}-${mes}-${dia}`;
      campoFechaPedido.value = fechaFormateada;
      campoFechaPedido.readOnly = true;
    }

    if (idiomaSelect) { // Asegurarse que idiomaSelect existe
        cambiarIdioma(idiomaSelect.value || 'es');
    }
    
    formaSelect = document.getElementById('forma'); 
    infoTamanoPastelDiv = document.getElementById('infoTamanoPastel'); 

    console.log("formaSelect encontrado (DOMContentLoaded):", formaSelect); 
    console.log("infoTamanoPastelDiv encontrado (DOMContentLoaded):", infoTamanoPastelDiv); 
    
    if (formaSelect && infoTamanoPastelDiv) { 
      console.log("Adjuntando listener a formaSelect (DOMContentLoaded)."); 
      formaSelect.addEventListener('change', function() {
        console.log("Forma select cambiÃ³. Valor:", this.value); 
        const currentLang = idiomaSelect ? (idiomaSelect.value || 'es') : 'es';
        const T = translations[currentLang] || translations.es;

        if (this.value === 'Circular 8"') {
          infoTamanoPastelDiv.innerHTML = T.infoCircular8 || "Mensaje no disponible (fallback).";
          infoTamanoPastelDiv.style.display = 'block';
        } else {
          infoTamanoPastelDiv.style.display = 'none';
          infoTamanoPastelDiv.innerHTML = '';
        }
      });
      formaSelect.dispatchEvent(new Event('change')); 
    } else {
      console.error("Error: No se pudo encontrar formaSelect o infoTamanoPastelDiv en DOMContentLoaded.");
    }

    if (modeloSelect) modeloSelect.dispatchEvent(new Event('change'));
    if (rellenosSelect) rellenosSelect.dispatchEvent(new Event('change'));
    if (entregaSelect) entregaSelect.dispatchEvent(new Event('change'));
    
  });
const tamanoVitrinaSelect = document.getElementById('tamanoVitrina');
const infoTamanoVitrinaDiv = document.getElementById('infoTamanoVitrina');

if (tamanoVitrinaSelect && infoTamanoVitrinaDiv) {
  tamanoVitrinaSelect.addEventListener('change', function () {
    if (this.value === '8"') {
      infoTamanoVitrinaDiv.innerHTML = "ğŸ‰ Â¡Genial elecciÃ³n! El tamaÃ±o de 8â€ es perfecto para reuniones familiares o con amigos. Rinde aproximadamente para 11 deliciosas porciones.";
      infoTamanoVitrinaDiv.style.display = 'block';
    } else {
      infoTamanoVitrinaDiv.style.display = 'none';
      infoTamanoVitrinaDiv.innerHTML = '';
    }
  });

 
  tamanoVitrinaSelect.dispatchEvent(new Event('change'));
}
</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-S67VHFS5MK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
 gtag('config', 'G-S67VHFS5MK');
</script>
    
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const btnEnviar = document.getElementById('btnEnviar');

    if (btnEnviar) {
      btnEnviar.addEventListener('click', function () {
        gtag('event', 'enviar_pedido', {
          'event_category': 'Formulario',
          'event_label': 'BotÃ³n Enviar Pedido',
          'value': 1
        });
      });
    }
  });
</script>
    </form>

<div class="section" style="max-width: 500px; margin: 30px auto; text-align: center; background: #fffafc; padding: 25px; border-radius: 16px; border: 2px dashed #ffb6c1; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
  <h3 style="margin-bottom: 20px; color: #d63384; font-family: 'Poppins', sans-serif; font-size: 22px;">
    ğŸ° Â¿EstÃ¡ lista tu torta? Â¡CompruÃ©balo aquÃ­! ğŸ€
  </h3>

  <input type="text" id="numeroConsulta" placeholder="Ej: 20250703-023" 
         style="padding: 12px 15px; font-size: 16px; width: 100%; margin-bottom: 15px; border: 1.5px solid #ffb6c1; border-radius: 8px; background-color: #fff;">
  
  <button onclick="consultarEstado()" 
          style="padding: 12px; font-size: 16px; width: 100%; background-color: #ff69b4; color: white; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: background 0.3s;">
    ğŸ” Consultar
  </button>
  
  <div id="resultadoEstado" style="margin-top: 20px;"></div>
</div>

<!-- FUNCIONALIDAD CONSULTAR ESTADO -->
<script>
function consultarEstado() {
  const numero = document.getElementById("numeroConsulta").value.trim();
  const resultado = document.getElementById("resultadoEstado");

  if (!numero) {
    resultado.innerHTML = `
      <div style="background:#fff3cd; color:#856404; padding:16px; border-radius:12px; border:1.5px dashed #ffeeba; font-family: 'Poppins', sans-serif; font-size: 15px;">
        âš ï¸ Por favor ingresa un nÃºmero de orden vÃ¡lido.
      </div>`;
    return;
  }

  resultado.innerHTML = `
    <div style="background:#f0f0f0; color:#41464b; padding:16px; border-radius:12px; border:1.5px solid #d6d8db; font-family: 'Poppins', sans-serif; font-size: 15px;">
      â³ Consultando estado...
    </div>`;

    fetch(`https://script.google.com/macros/s/AKfycbwMIhD7QKK1GvNNMUxjWxtyJV9jesFxNm1M22G7yGu8U2XWeep8Wu0VRWYl2nPK6kLoXQ/exec?numeroOrden=${numero}`)
    .then(res => res.json())
    .then(datos => {
      let colorFondo = "#f0f0f0";
      let colorTexto = "#333";
      let borde = "#ccc";
      let texto = "";

      if (datos.error) {
        colorFondo = "#fff8e1";
        colorTexto = "#856404";
        borde = "#ffeeba";
        texto = `âš ï¸ ${datos.error}<br><br>ğŸ“Œ Verifica que el nÃºmero de orden sea correcto.`;
      } else {
        const estado = datos.estado?.toLowerCase() || "pendiente";

        if (estado.includes("listo")) {
          colorFondo = "#e6ffed";
          colorTexto = "#2e7d32";
          borde = "#a5d6a7";
          texto = `ğŸ‰ <strong>Â¡Tu pastel estÃ¡ listo para entrega!</strong><br><br>
          Te esperamos con una gran sonrisa y mucha dulzura. ğŸ§âœ¨`;
        } else if (estado.includes("proceso")) {
          colorFondo = "#fff9e6";
          colorTexto = "#8a6d3b";
          borde = "#ffe0a3";
          texto = `ğŸ•’ <strong>Estamos preparando tu pastel con mucho amor.</strong><br><br>
          Gracias por tu paciencia, Â¡pronto estarÃ¡ listo para disfrutar! ğŸ‚ğŸ’•`;
        } else if (estado.includes("aceptado")) {
          colorFondo = "#e3f2fd";
          colorTexto = "#0277bd";
          borde = "#90caf9";
          texto = `âœ… <strong>Hemos aceptado tu pedido.</strong><br><br>
          Pronto comenzaremos a hornear magia para ti. ğŸ‰ğŸ°`;
        } else if (estado.includes("pendiente")) {
          colorFondo = "#f0f0f0";
          colorTexto = "#666";
          borde = "#ccc";
          texto = `âŒ› <strong>Tu pedido estÃ¡ pendiente de confirmaciÃ³n.</strong><br><br>
          En breve uno de nuestros asesores se comunicarÃ¡ contigo. ğŸ“ğŸ’¬`;
        } else if (estado.includes("cancelado")) {
          const motivo = datos.motivo || "No especificado";
          colorFondo = "#ffe6e6";
          colorTexto = "#c62828";
          borde = "#f5c6cb";
          texto = `âŒ <strong>Tu pedido ${datos.numeroOrden} fue cancelado.</strong><br><br>
          ğŸ“ Motivo: <em>${motivo}</em><br><br>
          ğŸ“ Si tienes dudas, con gusto te atenderemos.<br><br>
          <a href="https://wa.me/19802878716" target="_blank" style="color: #c62828; text-decoration: underline;">ğŸ“² EscrÃ­benos por WhatsApp</a>`;
        } else {
          colorFondo = "#e3f2fd";
          colorTexto = "#0277bd";
          borde = "#90caf9";
          texto = `ğŸ“¦ <strong>Seguimiento de tu pedido ${datos.numeroOrden}</strong>: <em>${datos.estado}</em><br><br>
          ğŸ° Estamos atentos para que tu pastel llegue como lo soÃ±aste. ğŸ’•`;
        }
      }

      resultado.innerHTML = `
        <div style="background:${colorFondo}; color:${colorTexto}; padding:18px; border-radius:12px; border:1.5px solid ${borde}; font-family: 'Poppins', sans-serif; font-size: 15px; text-align: left;">
          ${texto}
        </div>`;
    })
    .catch(error => {
      resultado.innerHTML = `
        <div style="background:#ffe6e6; color:#c62828; padding:16px; border-radius:12px; border:1.5px solid #f5c6cb; font-family: 'Poppins', sans-serif; font-size: 15px;">
          âŒ Error consultando el estado. Intenta nuevamente mÃ¡s tarde.
        </div>`;
      console.error(error);
    });
}
</script>

<a href="https://wa.me/19802878716" target="_blank" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #f0f0f0;
  color: #41464b;
  padding: 10px 16px;
  border-radius: 12px;
  border: 1.5px solid #d6d8db;
  font-family: 'Poppins', sans-serif;
  font-size: 14px;
  text-decoration: none;
  font-weight: 500;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  z-index: 999;
  transition: background-color 0.3s ease, transform 0.3s ease;
">
  ğŸ° Â¿Hablamos por WhatsApp?
</a>
  
</body>
</html>
