<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-translate-key="pageTitle">Manolo‚Äôs Bakery</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f8f8f8; }
    h2 { color: #444; }
    .section { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    label { display: block; margin: 10px 0 5px; }
    input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
    button { background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #218838; }
    img.preview { max-width: 200px; margin-top: 10px; border-radius: 5px; }
    .whatsapp-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #25D366;
      color: white;
      border-radius: 50px;
      padding: 12px 18px;
      font-size: 16px;
      text-decoration: none;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    .whatsapp-button:hover {
      background-color: #1ebe5d;
    }
    .whatsapp-button img {
      width: 24px;
      height: 24px;
      margin-right: 8px;
    }

    @media (max-width: 600px) {
      body { padding: 10px; }
      .section { padding: 15px; }
      input, select, textarea, button { font-size: 16px; }
      button { width: 100%; }
      .whatsapp-button { padding: 10px 14px; font-size: 14px; bottom: 15px; right: 15px; }
      .whatsapp-button img { width: 20px; height: 20px; }
      img.preview { max-width: 100%; height: auto; }
    }
    
    /* Correcci√≥n para inputs de fecha y hora en m√≥viles Iphone Safari y Google Chrome */
input[type="date"],
input[type="time"] {
  max-width: 100%;
  width: 100%;
  box-sizing: border-box;
  -webkit-appearance: none;
  appearance: none;
  font-size: 16px;
}
  </style>
</head>
<body>

  <h2 data-translate-key="formHeading"> üéÇManolo‚Äôs BakeryüéÇ </h2>

  <form id="formPedido">

    <div class="section">
      <label for="idioma" data-translate-key="labelIdioma">üåê Idioma:</label>
      <select id="idioma" name="idioma" required>
        <option value="es" data-translate-key="optionEspa√±ol">Espa√±ol</option>
        <option value="en" data-translate-key="optionEnglish">Ingl√©s</option>
        <option value="it" data-translate-key="optionItaliano">Italiano</option>
        <option value="otro" data-translate-key="optionOtro">Otro</option>
      </select>
    </div>

    <div class="section">
      <label for="modelo" data-translate-key="labelModeloVitrina">üç∞ Modelo (vitrina):</label>
      <select id="modelo" name="modelo">
        <option value="" data-translate-key="optionShowcaseDefault">-- Elija un modelo o personalice abajo --</option>
        <option value="Durazno" data-translate-key="optionDurazno">Durazno</option>
        <option value="Chocolate" data-translate-key="optionChocolate">Chocolate</option>
        <option value="Mocha" data-translate-key="optionMocha">Mocha</option>
        <option value="Caramelo" data-translate-key="optionCaramelo">Caramelo</option>
        <option value="Churros" data-translate-key="optionChurros">Churros</option>
      </select>

      <label for="tamanoVitrina" data-translate-key="labelTamanoVitrina">Tama√±o:</label>
      <select id="tamanoVitrina" name="tamanoVitrina">
        <option value="" data-translate-key="optionTamanoVitrinaDefault">--</option>
        <option value="6\"">6"</option>
        <option value="8\"">8"</option>
        <option value="10\"">10"</option>
      </select>

      <label for="fecha" data-translate-key="labelFechaPedido">üóì Fecha Pedido:</label>
      <input type="date" name="fecha" id="fecha">

      <label for="fechaRecogida" data-translate-key="labelFechaRecogida">üóì Fecha de recogida:</label>
      <input type="date" name="fechaRecogida" id="fechaRecogida" required>

      <label for="hora" data-translate-key="labelHora">‚è∞ Hora recogida/entrega:</label>
      <input type="time" name="hora" id="hora" required>

      <label for="entrega" data-translate-key="labelEntrega">üöö ¬øC√≥mo deseas recibirlo?</label>
      <select id="entrega" name="entrega" required>
        <option value="" data-translate-key="optionSeleccione">Seleccione</option>
        <option value="Recoger en la pasteler√≠a" data-translate-key="optionRecogerEnPasteleria">Recoger en la pasteler√≠a</option>
        <option value="Domicilio" data-translate-key="optionDomicilio">Domicilio</option>
      </select>
    </div>

    <div class="section" id="seccionPastelPersonalizado">
      <h3 data-translate-key="headingPastelPersonalizado">üç∞ Pastel Personalizado</h3>
      <label for="forma" data-translate-key="labelFormaYTamano">Forma y Tama√±o:</label>
      <select id="forma" name="forma">
        <option value="" data-translate-key="optionFormaYTamanoDefault">--</option>
        <option value="Circular 6\"" data-translate-key="optionCircular6">Circular 6"</option>
        <option value="Circular 8\"" data-translate-key="optionCircular8">Circular 8"</option>
        <option value="Circular 10\"" data-translate-key="optionCircular10">Circular 10"</option>
        <option value="Cuadrado 1/4 Sheet" data-translate-key="optionCuadrado1_4Sheet">Cuadrado 1/4 Sheet</option>
        <option value="Rectangular 1/2 Sheet" data-translate-key="optionRectangular1_2Sheet">Rectangular 1/2 Sheet</option>
      </select>
      <div id="infoTamanoPastel" style="display: none; margin-top: 8px; font-size: 0.9em; color: #2E7D32; padding: 8px; background-color: #E8F5E9; border-radius: 4px;"></div>

      <label for="tipoMasa" data-translate-key="labelTipoPastel">Tipo de Pastel:</label>
      <select id="tipoMasa" name="tipoMasa">
        <option value="Tres Leches Vainilla" data-translate-key="optionTresLechesVainilla">Tres Leches / Vainilla</option>
        <option value="Tres Leches Chocolate" data-translate-key="optionTresLechesChocolate">Tres Leches / Chocolate</option>
        <option value="Vainilla seco" data-translate-key="optionVainillaSeco">Vainilla seco</option>
        <option value="Chocolate seco" data-translate-key="optionChocolateSeco">Chocolate seco</option>
        <option value="Marmolado" data-translate-key="optionMarmolado">Marmolado</option>
        <option value="Mocca" data-translate-key="optionMoccaPersonalizado">Mocca</option>
        <option value="Maracuya" data-translate-key="optionMaracuya">Maracuy√°</option>
        <option value="Otro" data-translate-key="optionOtroTipoPastel">Otro</option>
      </select>

      <label for="capas" data-translate-key="labelCapas">Capas:</label>
      <input type="number" name="capas" min="1" max="5" placeholder="Ej: 2" data-translate-key="placeholderCapas">

      <label for="rellenos" data-translate-key="labelRellenos">Rellenos (selecci√≥n m√∫ltiple):</label>
      <select id="rellenos" name="rellenos[]" multiple size="6">
        <option value="Durazno" data-translate-key="optionDurazno">Durazno</option>
        <option value="Nuez" data-translate-key="optionNuez">Nuez</option>
        <option value="Chocolate Chips" data-translate-key="optionChocolateChips">Chocolate Chips</option>
        <option value="Mocca" data-translate-key="optionMoccaPersonalizado">Mocca</option>
        <option value="Cereza" data-translate-key="optionCereza">Cereza</option>
        <option value="Fresa Natural" data-translate-key="optionFresaNatural">Fresa Natural</option>
        <option value="Fresa Mermelada" data-translate-key="optionFresaMermelada">Fresa Mermelada</option>
        <option value="Chocolate Seco" data-translate-key="optionChocolateSecoRelleno">Chocolate Seco</option>
        <option value="Pi√±a Mermelada" data-translate-key="optionPinaMermelada">Pi√±a Mermelada</option>
        <option value="Caramelo" data-translate-key="optionCaramelo">Caramelo</option>
      </select>
      <small style="display: block; margin-top: 5px; font-size: 0.85em; color: #666;" data-translate-key="hintMultiSelect">Consejo: En escritorio, mant√©n presionada la tecla Ctrl (o Cmd en Mac) para seleccionar varios rellenos.</small>
      <div id="rellenosSeleccionados" style="margin-top: 8px; font-size: 0.9em; color: #555;"></div>

      <div id="seccionMezclaRellenos" style="display: none;">
        <label for="mezcla" data-translate-key="labelMezclaRellenos">¬øC√≥mo deseas los rellenos?</label>
        <select id="mezcla" name="mezcla">
          <option value="" data-translate-key="optionMezclaDefault">--</option>
          <option value="Mixeado" data-translate-key="optionMixeado">Mixeado</option>
          <option value="Mitad y Mitad" data-translate-key="optionMitadYMitad">Mitad y Mitad</option>
        </select>
      </div>
    </div>

    <div class="section" id="seccionDecoracion">
      <label for="decoracion" data-translate-key="labelDetallesDecoracion">üé® Detalles de Decoraci√≥n:</label>
      <textarea id="decoracion" name="decoracion" placeholder="Describe decoraciones, tem√°tica o instrucciones espec√≠ficas" data-translate-key="placeholderDecoracion"></textarea>

      <label for="mensajePastel" data-translate-key="labelMensajePastel">üìù Mensaje en el pastel:</label>
      <input type="text" id="mensajePastel" name="mensajePastel">
      <small style="display: block; margin-top: 4px; font-size: 0.85em; color: #666;" data-translate-key="hintMensajePastel">Si lo deseas, indica junto a tu mensaje si este va en la tapa o en la pared del pastel.</small>

      <label for="color" data-translate-key="labelColoresPredominantes">üé® Colores predominantes:</label>
      <input type="text" id="color" name="color" >
      <small style="display: block; margin-top: 4px; font-size: 0.85em; color: #666;" data-translate-key="hintColoresPredominantes">Ej: Azul primario, tonos pastel claros, rojo oscuro.</small>

   <label for="imagen" data-translate-key="labelImagenReferencia">üì∑ Imagen de referencia:</label>
   <input type="file" id="imagen" name="imagenReferencia" accept="image/*">
   <input type="hidden" name="urlImagen" id="urlImagen">
   <img class="preview" id="previewImg" style="display: none; max-width: 200px; margin-top: 10px;" />
        
    </div>

<div class="section">
  <label for="nombre" data-translate-key="labelNombreCompleto">üë§ Nombre completo:</label>
  <input type="text" id="nombre" name="nombre" required>

<label for="telefono" data-translate-key="labelTelefono">üìû Tel√©fono:</label>
<input type="tel" id="telefono" name="telefono" placeholder="+573001234567" data-translate-key="placeholderTelefono" pattern="^\+\d{10,15}$" required>
<small data-translate-key="hintTelefono">Incluye el indicativo del pa√≠s. Ejemplo: +573001234567</small>

  <label for="correo" data-translate-key="labelCorreo">üìß Correo electr√≥nico:</label>
  <input type="email" id="correo" name="correo" required>

  
<label for="comentarios" data-translate-key="labelComentarios">üí¨ Comentarios/Sugerencias:</label>
<textarea id="comentarios" name="comentarios" rows="4" placeholder="Escribe aqu√≠ tus comentarios o sugerencias..."></textarea>


  <div class="contact-preference-container" style="margin-top: 15px; margin-bottom: 10px;">
    <label data-translate-key="labelMetodoContactoPreferido" style="margin-bottom: 8px; display: block; font-weight: bold;">üí¨ ¬øC√≥mo prefieres ser contactado?</label>
    <div style="display: flex; align-items: center; margin-bottom: 5px;">
      <input type="radio" id="contactoWhatsapp" name="metodoContacto" value="whatsapp" checked style="width: auto; margin-right: 8px;">
      <label for="contactoWhatsapp" data-translate-key="optionContactoWhatsapp" style="font-weight: normal; margin: 0;">WhatsApp</label>
    </div>
<div style="display: flex; align-items: center;">
      <input type="radio" id="contactoCorreo" name="metodoContacto" value="correo" style="width: auto; margin-right: 8px;">
      <label for="contactoCorreo" data-translate-key="optionContactoCorreo" style="font-weight: normal; margin: 0;">Correo Electr√≥nico</label>
    </div>
  </div>

  <div id="direccionSection" style="display:none;">
    <label for="direccion" data-translate-key="labelDireccion">üìç Direcci√≥n:</label>
    <textarea id="direccion" name="direccion" placeholder="Ingresa tu direcci√≥n completa para el domicilio" data-translate-key="placeholderDireccion"></textarea>
  </div>
</div>

<div class="section">
  <p id="textoEnvioConfirmacion" data-translate-key="textEnvioConfirmacion">
üçæ Al hacer clic en enviar, generaremos tu n√∫mero de orden y confirmaremos el pedido por <strong>WhatsApp</strong> o <strong>Correo</strong> seg√∫n tu elecci√≥n.
  </p>
<button id="btnEnviar" type="submit" data-translate-key="buttonEnviarPedido">
    ‚úÖ Enviar Pedido
  </button>
<span id="estadoEnvio" style="margin-left: 10px; display: none; color: #555;">
    ‚è≥ Enviando pedido...
  </span>
</div>

<script>
  const radiosMetodo = document.querySelectorAll('input[name="metodoContacto"]');
  const textoEnvio = document.getElementById('textoEnvioConfirmacion');

  radiosMetodo.forEach(radio => {
    radio.addEventListener('change', () => {
      const metodo = document.querySelector('input[name="metodoContacto"]:checked')?.value || '';
      if (metodo === 'whatsapp') {
        textoEnvio.innerHTML = 'üçæ Al hacer clic en enviar, se generar√° tu n√∫mero de orden y se confirmar√° el pedido a trav√©s <strong>WhatsApp</strong>.';
      } else {
        textoEnvio.innerHTML = 'üçæ Al hacer clic en enviar, se generar√° tu n√∫mero de orden y se confirmar√° el pedido a trav√©s de <strong>Correo Electr√≥nico</strong>.';
      }
    });
  });
</script>

    
<script>
  // Evita que se abra el selector imagen de referencia para fase 2
  document.getElementById('imagen').addEventListener('click', function (e) {
    e.preventDefault(); // No permite que se abra el selector de imagenes
  });
</script>

<div class="section" style="margin-top: 40px; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
  <h3 style="font-size: 20px; margin-bottom: 10px;">üîé Consultar estado de pedido</h3>
  <label for="numeroConsulta" style="display: block; margin-bottom: 5px;">Ingresa tu n√∫mero de orden:</label>
  <input type="text" id="numeroConsulta" placeholder="Ej: 20250703-023"
         style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; margin-bottom: 10px;">

  <button onclick="consultarEstado()" style="background-color: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
    Consultar estado
  </button>

  <div id="resultadoEstado" style="margin-top: 15px; padding: 12px; border-left: 5px solid #ccc; border-radius: 5px; display: none;">
    <strong>Estado:</strong> <span id="estadoTexto">Esperando...</span>
  </div>
</div>

<script>
  function consultarEstado() {
    const numero = document.getElementById("numeroConsulta").value.trim();
    const resultado = document.getElementById("resultadoEstado");
    const estadoTexto = document.getElementById("estadoTexto");

    if (!numero) {
      estadoTexto.textContent = "‚ö†Ô∏è Por favor ingresa un n√∫mero de orden.";
      resultado.style.display = "block";
      resultado.style.borderLeftColor = "#ffc107"; // Amarillo
      return;
    }

    estadoTexto.textContent = "‚è≥ Consultando estado...";
    resultado.style.display = "block";
    resultado.style.borderLeftColor = "#007bff"; // Azul

    fetch(`https://script.google.com/macros/s/AKfycbxhMJmPJG8_Lkcn5yMdEW9_sldAHcWgNmt6OugicspTbY9WaJZlj7A35x4YZDi6MGq34g/exec?numeroOrden=${numero}`)
      .then(res => res.text())
      .then(texto => {
        estadoTexto.textContent = texto;

        // Ajustar color seg√∫n estado
        const textoLimpio = texto.toLowerCase();
        if (textoLimpio.includes("entregado")) {
          resultado.style.borderLeftColor = "#28a745"; // Verde
        } else if (textoLimpio.includes("listo")) {
          resultado.style.borderLeftColor = "#17a2b8"; // Celeste
        } else if (textoLimpio.includes("pendiente")) {
          resultado.style.borderLeftColor = "#ffc107"; // Amarillo
        } else {
          resultado.style.borderLeftColor = "#dc3545"; // Rojo (error u otro)
        }
      })
      .catch(error => {
        estadoTexto.textContent = "‚ùå Error consultando el estado. Intenta nuevamente.";
        resultado.style.borderLeftColor = "#dc3545"; // Rojo
        console.error(error);
      });
  }
</script>


    <a class="whatsapp-button" href="https://wa.me/573027697351?text=Hola%2C%20necesito%20ayuda%20con%20mi%20pedido%20de%20pastel" target="_blank">
  <img src="https://cdn-icons-png.flaticon.com/512/220/220236.png" alt="WhatsApp"> <span data-translate-key="textNecesitasAyuda">¬øNecesitas ayuda?</span>
</a>
        
<script>
  console.log("INICIO DEL SCRIPT TAG EJECUTADO"); 

  const translations = {
  es: {
    pageTitle: "Manolo‚Äôs Bakery",
    formHeading: "üéÇManolo‚Äôs BakeryüéÇ",
    labelIdioma: "üåê Idioma:",
    optionEspa√±ol: "Espa√±ol",
    optionEnglish: "Ingl√©s",
    optionItaliano: "Italiano",
    optionOtro: "Otro",
    labelModeloVitrina: "üç∞ Modelo (vitrina):",
    optionShowcaseDefault: "-- Elija un modelo o personalice abajo --",
    optionDurazno: "Durazno",
    optionChocolate: "Chocolate",
    optionMocha: "Mocha",
    optionCaramelo: "Caramelo",
    optionChurros: "Churros",
    labelTamanoVitrina: "Tama√±o:",
    labelFechaPedido: "üóì Fecha Pedido:",
    labelFechaRecogida: "üóì Fecha de recogida:",
    labelHora: "‚è∞ Hora recogida/entrega:",
    labelEntrega: "üöö ¬øC√≥mo deseas recibirlo?",
    optionSeleccione: "Seleccione",
    optionRecogerEnPasteleria: "Recoger en la pasteler√≠a",
    optionDomicilio: "Domicilio",
    headingPastelPersonalizado: "üç∞ Pastel Personalizado",
    labelFormaYTamano: "Forma y Tama√±o:",
    optionCircular6: "Circular 6\"",
    optionCircular8: "Circular 8\"",
    optionCircular10: "Circular 10\"",
    optionCuadrado1_4Sheet: "Cuadrado 1/4 Sheet",
    optionRectangular1_2Sheet: "Rectangular 1/2 Sheet",
    labelTipoPastel: "Tipo de Pastel:",
    optionTresLechesVainilla: "Tres Leches / Vainilla",
    optionTresLechesChocolate: "Tres Leches / Chocolate",
    optionVainillaSeco: "Vainilla seco",
    optionChocolateSeco: "Chocolate seco",
    optionMarmolado: "Marmolado",
    optionMoccaPersonalizado: "Mocca",
    optionMaracuya: "Maracuy√°",
    optionOtroTipoPastel: "Otro",
    labelCapas: "Capas:",
    placeholderCapas: "Ej: 2",
    labelRellenos: "Rellenos (selecci√≥n m√∫ltiple):",
    optionNuez: "Nuez",
    optionChocolateChips: "Chocolate Chips",
    optionCereza: "Cereza",
    optionFresaNatural: "Fresa Natural",
    optionFresaMermelada: "Fresa Mermelada",
    optionChocolateSecoRelleno: "Chocolate Seco",
    optionPinaMermelada: "Pi√±a Mermelada",
    hintMultiSelect: "Consejo: En escritorio, mant√©n presionada la tecla Ctrl (o Cmd en Mac) para seleccionar varios rellenos.",
    textNoFillingsSelected: "<em>Ning√∫n relleno seleccionado.</em>",
    textCurrentFillingsLabel: "<strong>Rellenos seleccionados:</strong> ",
    labelMezclaRellenos: "¬øC√≥mo deseas los rellenos?",
    optionMezclaDefault: "--",
    optionMixeado: "Mixeado",
    optionMitadYMitad: "Mitad y Mitad",
    labelDetallesDecoracion: "üé® Detalles de Decoraci√≥n:",
    placeholderDecoracion: "Describe decoraciones, tem√°tica o instrucciones espec√≠ficas",
    labelMensajePastel: "üìù Mensaje en el pastel:",
    hintMensajePastel: "Si lo deseas, indica junto a tu mensaje si este va en la tapa o en la pared del pastel.",
    labelColoresPredominantes: "üé® Colores predominantes:",
    hintColoresPredominantes: "Ej: Azul primario, tonos pastel claros, rojo oscuro.",
    labelImagenReferencia: "üì∑ Imagen de referencia:",
    labelNombreCompleto: "üë§ Nombre completo:",
    labelTelefono: "üìû Tel√©fono:",
    placeholderTelefono: "+573001234567",
    hintTelefono: "Incluye el indicativo del pa√≠s. Ejemplo: +573001234567",
    labelCorreo: "üìß Correo electr√≥nico:",
    labelMetodoContactoPreferido: "üí¨ ¬øC√≥mo prefieres ser contactado?",
    optionContactoWhatsapp: "WhatsApp",
    optionContactoCorreo: "Correo Electr√≥nico",
    labelDireccion: "üìç Direcci√≥n:",
    placeholderDireccion: "Ingresa tu direcci√≥n completa para el domicilio",
    textEnvioConfirmacion: "üçæ Al hacer clic en enviar, se generar√° tu n√∫mero de orden y se confirmar√° el pedido a trav√©s WhatsApp.",
    buttonEnviarPedido: "‚úÖ Enviar Pedido",
    textNecesitasAyuda: "¬øNecesitas ayuda?",
    alertPedidoExito: "üéÇ Tu pedido ha sido registrado con √©xito.",
    alertNumeroOrden: "üßæ N√∫mero de orden: ",
    alertTuPedidoEs: "üì¶ Tu pedido es:",
    alertConfirmacionWhatsApp: "‚úÖ Te confirmaremos por WhatsApp en breve.",
    alertErrorPedido: "‚ùå Hubo un error al registrar tu pedido. Intenta nuevamente.",
    resumenTipo: "üç∞ Tipo:",
    resumenFecha: "üìÖ Fecha:",
    resumenHoraConector: "a las",
    resumenEntrega: "üöö Entrega:",
    resumenEntregaDomicilioConector: "a",
    resumenDecoracion: "üé® Decoraci√≥n:",
    resumenDecoracionDefault: "Sin detalles",
    resumenMensaje: "üìù Mensaje:",
    resumenMensajeDefault: "Ninguno",
    resumenCliente: "üìû Cliente:",
    resumenMetodoContacto: "üìû M√©todo de contacto:", 
    whatsappHolaPedidoWeb: "Hola, hice un pedido en la web.",
    whatsappMiNumeroOrdenEs: "Mi n√∫mero de orden es:",
    whatsappMiPedidoEs: "Mi pedido es:",
    whatsappPorFavorConfirmen: "Por favor confirmen. üéÇ",
    errorRequired: "Este campo es obligatorio.",
    errorWhitespace: "Este campo no puede consistir solo de espacios en blanco.",
    errorInvalidEmail: "Por favor, introduce una direcci√≥n de correo electr√≥nico v√°lida.",
    errorInvalidPhone: "Por favor, introduce un n√∫mero de tel√©fono v√°lido (ej: +1234567890).",
    errorDatePast: "La fecha no puede ser en el pasado.",
    errorDateOrder: "La fecha de recogida debe ser igual o posterior a la fecha del pedido.",
    errorMinLength: "Debe tener al menos {minLength} caracteres.",
    errorMinLength2: "El nombre debe tener al menos 2 caracteres.",
    errorNumberRange: "Debe ser un n√∫mero entre {min} y {max}.",
    errorCapasRange: "El n√∫mero de capas debe ser entre 1 y 5.",
    errorFileTooLarge: "El archivo es demasiado grande. M√°ximo {maxSize}MB.",
    errorInvalidFileType: "Tipo de archivo no v√°lido. Permitidos: {fileTypes}.",
    errorRecogidaAnticipacion: "El pedido debe realizarse con al menos 12 horas de anticipaci√≥n. Por favor, ajusta la fecha/hora de recogida o cont√°ctanos para pedidos urgentes.",
    alertConfirmacionCorreo: "‚úÖ Te confirmaremos por correo electr√≥nico en breve.",
    infoCircular8: "¬°Genial elecci√≥n! El tama√±o de 8‚Äù es perfecto para reuniones familiares o con amigos. Rinde aproximadamente para 11 deliciosas porciones."
  },
  en: { // ... (Traducciones EN completas incluyendo optionMezclaDefault: "--") ...
    pageTitle: "Manolos Bakery",
    formHeading: "üéÇManolo‚Äôs BakeryüéÇ",
    labelIdioma: "üåê Language:",
    optionEspa√±ol: "Spanish",
    optionEnglish: "English",
    optionItaliano: "Italian",
    optionOtro: "Other",
    labelModeloVitrina: "üç∞ Display Case Model:",
    optionShowcaseDefault: "-- Choose a model or customize below --",
    optionDurazno: "Peach",
    optionChocolate: "Chocolate",
    optionMocha: "Mocha",
    optionCaramelo: "Caramel",
    optionChurros: "Churros",
    labelTamanoVitrina: "Size:",
    labelFechaPedido: "üóì Order Date:",
    labelFechaRecogida: "üóì Pickup Date:",
    labelHora: "‚è∞ Time:",
    labelEntrega: "üöö How do you want to receive it?",
    optionSeleccione: "Select",
    optionRecogerEnPasteleria: "Pick up at the bakery",
    optionDomicilio: "Delivery",
    headingPastelPersonalizado: "üç∞ Custom Cake",
    labelFormaYTamano: "Shape and Size:",
    optionCircular6: "Circular 6\"",
    optionCircular8: "Circular 8\"",
    optionCircular10: "Circular 10\"",
    optionCuadrado1_4Sheet: "Square 1/4 Sheet",
    optionRectangular1_2Sheet: "Rectangular 1/2 Sheet",
    labelTipoPastel: "Type of Cake:",
    optionTresLechesVainilla: "Tres Leches / Vanilla",
    optionTresLechesChocolate: "Tres Leches / Chocolate",
    optionVainillaSeco: "Dry Vanilla",
    optionChocolateSeco: "Dry Chocolate",
    optionMarmolado: "Marble",
    optionMoccaPersonalizado: "Mocha",
    optionMaracuya: "Passion Fruit",
    optionOtroTipoPastel: "Other",
    labelCapas: "Layers:",
    placeholderCapas: "Ex: 2",
    labelRellenos: "Fillings (multiple selection):",
    optionNuez: "Walnut",
    optionChocolateChips: "Chocolate Chips",
    optionCereza: "Cherry",
    optionFresaNatural: "Fresh Strawberry",
    optionFresaMermelada: "Strawberry Jam",
    optionChocolateSecoRelleno: "Dry Chocolate",
    optionPinaMermelada: "Pineapple Jam",
    hintMultiSelect: "Tip: On desktop, hold Ctrl (or Cmd on Mac) to select multiple fillings.",
    textNoFillingsSelected: "<em>No fillings selected.</em>",
    textCurrentFillingsLabel: "<strong>Selected fillings:</strong> ",
    labelMezclaRellenos: "How do you want the fillings?",
    optionMezclaDefault: "--",
    optionMixeado: "Mixed",
    optionMitadYMitad: "Half and Half",
    labelDetallesDecoracion: "üé® Decoration Details:",
    placeholderDecoracion: "Describe decorations, theme, or specific instructions",
    labelMensajePastel: "üìù Message on the cake:",
    hintMensajePastel: "If you wish, indicate along with your message if it goes on the top or side of the cake.",
    labelColoresPredominantes: "üé® Predominant Colors:",
    hintColoresPredominantes: "Ex: Primary blue, light pastel tones, dark red.",
    labelImagenReferencia: "üì∑ Reference Image:",
    labelNombreCompleto: "üë§ Full Name:",
    labelTelefono: "üìû Phone:",
    placeholderTelefono: "+16501234567",
    hintTelefono: "Include country code. Example: +16501234567",
    labelCorreo: "üìß Email:",
    labelMetodoContactoPreferido: "üí¨ How do you prefer to be contacted?",
    optionContactoWhatsapp: "WhatsApp",
    optionContactoCorreo: "Email",
    resumenMetodoContacto: "üìû Preferred contact method:",
    labelDireccion: "üìç Address:",
    placeholderDireccion: "Enter your full address for delivery",
    textEnvioConfirmacion: "üçæ By clicking send, your order number will be generated and the order will be confirmed via WhatsApp.",
    buttonEnviarPedido: "‚úÖ Send Order",
    textNecesitasAyuda: "Need help?",
    alertPedidoExito: "üéÇ Your order has been successfully registered.",
    alertNumeroOrden: "üßæ Order number: ",
    alertTuPedidoEs: "üì¶ Your order is:",
    alertConfirmacionWhatsApp: "‚úÖ We will confirm via WhatsApp shortly.",
    alertErrorPedido: "‚ùå There was an error registering your order. Try again.",
    resumenTipo: "üç∞ Type:",
    resumenFecha: "üìÖ Date:",
    resumenHoraConector: "at",
    resumenEntrega: "üöö Delivery:",
    resumenEntregaDomicilioConector: "to",
    resumenDecoracion: "üé® Decoration:",
    resumenDecoracionDefault: "No details",
    resumenMensaje: "üìù Message:",
    resumenMensajeDefault: "None",
    resumenCliente: "üìû Customer:",
    whatsappHolaPedidoWeb: "Hello, I placed an order on the website.",
    whatsappMiNumeroOrdenEs: "My order number is:",
    whatsappMiPedidoEs: "My order is:",
    whatsappPorFavorConfirmen: "Please confirm. üéÇ",
    errorRequired: "This field is required.",
    errorWhitespace: "This field cannot consist of only whitespace.",
    errorInvalidEmail: "Please enter a valid email address.",
    errorInvalidPhone: "Please enter a valid phone number (e.g., +1234567890).",
    errorDatePast: "Date cannot be in the past.",
    errorDateOrder: "Pickup date must be on or after the order date.",
    errorMinLength: "Must be at least {minLength} characters.",
    errorMinLength2: "Name must be at least 2 characters.",
    errorNumberRange: "Must be a number between {min} and {max}.",
    errorCapasRange: "Number of layers must be between 1 and 5.",
    errorFileTooLarge: "File is too large. Maximum {maxSize}MB.",
    errorInvalidFileType: "Invalid file type. Allowed: {fileTypes}.",
    errorRecogidaAnticipacion: "The order must be placed at least 12 hours in advance. Please adjust the pickup date/time or contact us for rush orders.",
    alertConfirmacionCorreo: "‚úÖ We will confirm your request by email shortly.",
    infoCircular8: "Great choice! The 8\" size is perfect for family or friends gatherings. Makes approximately 11 delicious servings."
  },
  it: { // ... (Traducciones IT completas incluyendo optionMezclaDefault: "--") ...
    pageTitle: "Panificio Manolos",
    formHeading: "üéÇPanificio ManoloüéÇ",
    labelIdioma: "üåê Lingua:",
    optionEspa√±ol: "Spagnolo",
    optionEnglish: "Inglese",
    optionItaliano: "Italiano",
    optionOtro: "Altro",
    labelModeloVitrina: "üç∞ Modello (vetrina):",
    optionShowcaseDefault: "-- Scegli un modello o personalizza sotto --",
    optionDurazno: "Pesca",
    optionChocolate: "Cioccolato",
    optionMocha: "Moka",
    optionCaramelo: "Caramello",
    optionChurros: "Churros",
    labelTamanoVitrina: "Dimensione:",
    labelFechaPedido: "üóì Data Ordine:",
    labelFechaRecogida: "üóì Data di ritiro:",
    labelHora: "‚è∞ Ora:",
    labelEntrega: "üöö Come desideri riceverlo?",
    optionSeleccione: "Seleziona",
    optionRecogerEnPasteleria: "Ritiro in pasticceria",
    optionDomicilio: "Domicilio",
    headingPastelPersonalizado: "üç∞ Torta Personalizzata",
    labelFormaYTamano: "Forma e Dimensione:",
    optionCircular6: "Circolare 6\"",
    optionCircular8: "Circolare 8\"",
    optionCircular10: "Circolare 10\"",
    optionCuadrado1_4Sheet: "Quadrata 1/4 Foglio",
    optionRectangular1_2Sheet: "Rettangolare 1/2 Foglio",
    labelTipoPastel: "Tipo di Torta:",
    optionTresLechesVainilla: "Tres Leches / Vaniglia",
    optionTresLechesChocolate: "Tres Leches / Cioccolato",
    optionVainillaSeco: "Vaniglia secca",
    optionChocolateSeco: "Cioccolato secco",
    optionMarmolado: "Marmorizzata",
    optionMoccaPersonalizado: "Moka",
    optionMaracuya: "Frutto della Passione",
    optionOtroTipoPastel: "Altro",
    labelCapas: "Strati:",
    placeholderCapas: "Es: 2",
    labelRellenos: "Ripieni (selezione multipla):",
    optionNuez: "Noce",
    optionChocolateChips: "Gocce di Cioccolato",
    optionCereza: "Ciliegia",
    optionFresaNatural: "Fragola Fresca",
    optionFresaMermelada: "Confettura di Fragole",
    optionChocolateSecoRelleno: "Cioccolato Secco",
    optionPinaMermelada: "Confettura di Ananas",
    hintMultiSelect: "Suggerimento: Su desktop, tieni premuto Ctrl (o Cmd su Mac) per selezionare pi√π ripieni.",
    textNoFillingsSelected: "<em>Nessun ripieno selezionato.</em>",
    textCurrentFillingsLabel: "<strong>Ripieni selezionati:</strong> ",
    labelMezclaRellenos: "Come desideri i ripieni?",
    optionMezclaDefault: "--",
    optionMixeado: "Misti",
    optionMitadYMitad: "Met√† e Met√†",
    labelDetallesDecoracion: "üé® Dettagli Decorazione:",
    placeholderDecoracion: "Descrivi decorazioni, tema o istruzioni specifiche",
    labelMensajePastel: "üìù Messaggio sulla torta:",
    hintMensajePastel: "Se lo desideri, indica insieme al tuo messaggio se va sulla parte superiore o laterale della torta.",
    labelColoresPredominantes: "üé® Colori predominanti:",
    hintColoresPredominantes: "Es: Blu primario, tonalit√† pastello chiare, rosso scuro.",
    labelImagenReferencia: "üì∑ Immagine di riferimento:",
    labelNombreCompleto: "üë§ Nome completo:",
    labelTelefono: "üìû Telefono:",
    placeholderTelefono: "+391234567890",
    hintTelefono: "Includi il prefisso internazionale. Esempio: +391234567890",
    labelCorreo: "üìß Email:",
    labelMetodoContactoPreferido: "üí¨ Come preferisci essere contattato?",
    optionContactoWhatsapp: "WhatsApp",
    optionContactoCorreo: "Email",
    resumenMetodoContacto: "üìû Metodo di contatto preferito:",
    labelDireccion: "üìç Indirizzo:",
    placeholderDireccion: "Inserisci il tuo indirizzo completo per la consegna",
    textEnvioConfirmacion: "üçæ Cliccando invia, verr√† generato il tuo numero d'ordine e l'ordine verr√† confermato tramite WhatsApp.",
    buttonEnviarPedido: "‚úÖ Invia Ordine",
    textNecesitasAyuda: "Serve aiuto?",
    alertPedidoExito: "üéÇ Il tuo ordine √® stato registrato con successo.",
    alertNumeroOrden: "üßæ Numero d'ordine: ",
    alertTuPedidoEs: "üì¶ Il tuo ordine √®:",
    alertConfirmacionWhatsApp: "‚úÖ Confermeremo via WhatsApp a breve.",
    alertErrorPedido: "‚ùå Si √® verificato un errore durante la registrazione del tuo ordine. Riprova.",
    resumenTipo: "üç∞ Tipo:",
    resumenFecha: "üìÖ Data:",
    resumenHoraConector: "alle",
    resumenEntrega: "üöö Consegna:",
    resumenEntregaDomicilioConector: "a",
    resumenDecoracion: "üé® Decorazione:",
    resumenDecoracionDefault: "Nessun dettaglio",
    resumenMensaje: "üìù Messaggio:",
    resumenMensajeDefault: "Nessuno",
    resumenCliente: "üìû Cliente:",
    whatsappHolaPedidoWeb: "Ciao, ho effettuato un ordine sul sito web.",
    whatsappMiNumeroOrdenEs: "Il mio numero d'ordine √®:",
    whatsappMiPedidoEs: "Il mio ordine √®:",
    whatsappPorFavorConfirmen: "Si prega di confermare. üéÇ",
    errorRequired: "Questo campo √® obbligatorio.",
    errorWhitespace: "Questo campo non pu√≤ consistere solo di spazi bianchi.",
    errorInvalidEmail: "Inserisci un indirizzo email valido.",
    errorInvalidPhone: "Inserisci un numero di telefono valido (es: +1234567890).",
    errorDatePast: "La data non pu√≤ essere nel passato.",
    errorDateOrder: "La data di ritiro deve essere uguale o successiva alla data dell'ordine.",
    errorMinLength: "Deve contenere almeno {minLength} caratteri.",
    errorMinLength2: "Il nome deve contenere almeno 2 caratteri.",
    errorNumberRange: "Deve essere un numero compreso tra {min} e {max}.",
    errorCapasRange: "Il numero di strati deve essere compreso tra 1 e 5.",
    errorFileTooLarge: "Il file √® troppo grande. Massimo {maxSize}MB.",
    errorInvalidFileType: "Tipo di file non valido. Consentiti: {fileTypes}.",
    errorRecogidaAnticipacion: "L'ordine deve essere effettuato con almeno 12 ore di anticipo. Si prega di modificare la data/ora di ritiro o di contattarci per ordini urgenti.",
    alertConfirmacionCorreo: "‚úÖ Confermeremo a breve la tua richiesta via e-mail.",
    infoCircular8: "Ottima scelta! Il formato da 8‚Äù √® perfetto per le riunioni di famiglia o con gli amici. Per circa 11 deliziose porzioni."
  }
};

  // --- INICIO L√ìGICA DE TRADUCCI√ìN ---
  const idiomaSelect = document.getElementById('idioma');

  function cambiarIdioma(lang) {
    const currentTranslations = translations[lang] || translations.es; 

    document.querySelectorAll('[data-translate-key]').forEach(element => {
      const key = element.getAttribute('data-translate-key');
      const translation = currentTranslations[key];

      if (translation !== undefined) {
        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
          if (element.type === 'submit' || element.type === 'button') {
            element.value = translation;
          } else if (element.placeholder !== undefined && (key.endsWith('Placeholder') || key.startsWith('placeholder') || key.startsWith('hint') )) { // Ajustado para incluir 'hint'
            element.placeholder = translation;
          }
        } else if (element.tagName === 'OPTION') {
          element.innerText = translation;
        } else {
          element.innerHTML = translation; 
        }
      }
    });
    
    if (typeof rellenosSelect !== 'undefined' && rellenosSelect && typeof rellenosSeleccionadosDiv !== 'undefined' && rellenosSeleccionadosDiv) {
        const seleccionados = Array.from(rellenosSelect.selectedOptions).map(option => option.text); 
        if (seleccionados.length > 0) {
            rellenosSeleccionadosDiv.innerHTML = (currentTranslations['textCurrentFillingsLabel'] || translations.es['textCurrentFillingsLabel']) + seleccionados.join(', ');
        } else {
            rellenosSeleccionadosDiv.innerHTML = currentTranslations['textNoFillingsSelected'] || translations.es['textNoFillingsSelected'];
        }
    }
    // Actualizar mensaje de tama√±o si est√° visible
    if (typeof formaSelect !== 'undefined' && formaSelect && typeof infoTamanoPastelDiv !== 'undefined' && infoTamanoPastelDiv && infoTamanoPastelDiv.style.display === 'block' && formaSelect.value === 'Circular 8"') {
        infoTamanoPastelDiv.innerHTML = currentTranslations.infoCircular8 || translations.es.infoCircular8;
    }
  }

  if (idiomaSelect) {
    idiomaSelect.addEventListener('change', function(event) {
      cambiarIdioma(event.target.value);
    });
  }
  // --- FIN L√ìGICA DE TRADUCCI√ìN ---

  const form = document.getElementById('formPedido');
  const preview = document.getElementById('previewImg');
  const entregaSelect = document.getElementById('entrega');
  const direccionSection = document.getElementById('direccionSection');
  const rellenosSelect = document.getElementById('rellenos');
  const rellenosSeleccionadosDiv = document.getElementById('rellenosSeleccionados');
  const seccionMezclaRellenos = document.getElementById('seccionMezclaRellenos');
  const modeloSelect = document.getElementById('modelo');
  const seccionPastelPersonalizado = document.getElementById('seccionPastelPersonalizado');
  const seccionDecoracion = document.getElementById('seccionDecoracion');
  const imagenInput = document.getElementById('imagen');
  const mezclaSelect = document.getElementById('mezcla'); 
  let formaSelect; 
  let infoTamanoPastelDiv; 

  if (entregaSelect) {
    entregaSelect.addEventListener('change', function () {
      if(direccionSection) direccionSection.style.display = this.value === 'Domicilio' ? 'block' : 'none';
    });
  }

  function resetearCamposOpcionales() {
    if (seccionPastelPersonalizado) {
      const camposPersonalizado = seccionPastelPersonalizado.querySelectorAll('input, select, textarea');
      camposPersonalizado.forEach(campo => {
        if (campo.type === 'text' || campo.type === 'number' || campo.type === 'email' || campo.tagName === 'TEXTAREA') {
          campo.value = '';
        } else if (campo.tagName === 'SELECT') {
          if (campo.multiple) {
            Array.from(campo.options).forEach(option => option.selected = false);
            if (campo.id === 'rellenos' && rellenosSelect) { //A√±adida verificaci√≥n
              rellenosSelect.dispatchEvent(new Event('change')); 
            }
          } else {
            campo.selectedIndex = 0;
          }
        }
      });
       if (infoTamanoPastelDiv) { // Ocultar y limpiar el div de info tama√±o pastel
            infoTamanoPastelDiv.style.display = 'none';
            infoTamanoPastelDiv.innerHTML = '';
        }
    }

    if (seccionDecoracion) {
      const camposDecoracion = seccionDecoracion.querySelectorAll('input[type="text"], textarea');
      camposDecoracion.forEach(campo => {
        campo.value = '';
      });
      if (imagenInput) {
        imagenInput.value = ''; 
      }
      if (preview) {
        preview.src = '';
        preview.style.display = 'none'; 
      }
    }
  }

  if (modeloSelect) {
    modeloSelect.addEventListener('change', function() {
      const mostrarPersonalizacion = this.value === "";
      if (seccionPastelPersonalizado) seccionPastelPersonalizado.style.display = mostrarPersonalizacion ? 'block' : 'none';
      if (seccionDecoracion) seccionDecoracion.style.display = mostrarPersonalizacion ? 'block' : 'none';
      
      if (!mostrarPersonalizacion) {
        resetearCamposOpcionales(); 
      }
    });
  }

  if (rellenosSelect) {
    rellenosSelect.addEventListener('change', function() {
      const currentLang = idiomaSelect ? (idiomaSelect.value || 'es') : 'es';
      const T = translations[currentLang] || translations.es;

      const seleccionados = Array.from(this.selectedOptions); // Obtener opciones, no solo texto
      const nombresSeleccionados = seleccionados.map(opt => opt.text);

      if (rellenosSeleccionadosDiv) {
        if (nombresSeleccionados.length > 0) {
          rellenosSeleccionadosDiv.innerHTML = (T['textCurrentFillingsLabel'] || "<strong>Rellenos seleccionados:</strong> ") + nombresSeleccionados.join(', ');
        } else {
          rellenosSeleccionadosDiv.innerHTML = T['textNoFillingsSelected'] || "<em>Ning√∫n relleno seleccionado.</em>";
        }
      }

      if (seccionMezclaRellenos) {
        if (nombresSeleccionados.length > 1) {
          seccionMezclaRellenos.style.display = 'block';
        } else {
          seccionMezclaRellenos.style.display = 'none';
          if (mezclaSelect) { 
            mezclaSelect.selectedIndex = 0; 
          }
        }
      }
    });
  }
  
  if (document.getElementById('imagen')) {
    document.getElementById('imagen').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file && preview) {
        const reader = new FileReader();
        reader.onload = function (e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else if (preview) {
        preview.src = '';
        preview.style.display = 'none';
      }
    });
  }

  function generarOrden() {
    const hoy = new Date();
    const anio = hoy.getFullYear();
    const mes = String(hoy.getMonth() + 1).padStart(2, '0');
    const dia = String(hoy.getDate()).padStart(2, '0');
    const fechaAAAAMMDD = `${anio}${mes}${dia}`;
    const aleatorioXXX = String(Math.floor(Math.random() * 1000)).padStart(3, '0');
    return `${fechaAAAAMMDD}-${aleatorioXXX}`;
  }

  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault(); 

      const currentLang = idiomaSelect ? (idiomaSelect.value || 'es') : 'es';
      const T = translations[currentLang] || translations.es;

      const fechaRecogidaVal = document.getElementById('fechaRecogida').value;
      const horaRecogidaVal = document.getElementById('hora').value;

      if (fechaRecogidaVal && horaRecogidaVal) { 
        const dateTimeRecogida = new Date(`${fechaRecogidaVal}T${horaRecogidaVal}`);
        const ahora = new Date();
        const limiteRecogida = new Date(ahora.getTime() + 12 * 60 * 60 * 1000); 

        if (dateTimeRecogida < limiteRecogida) {
          alert(T.errorRecogidaAnticipacion || "El pedido debe realizarse con al menos 12 horas de anticipaci√≥n...");
          return; 
        }
      } else if (!fechaRecogidaVal || !horaRecogidaVal) {
         // Si los campos son required en HTML, el navegador deber√≠a prevenir esto.
         // Si no, y quieres validarlo aqu√≠:
         // alert(T.errorRequired || "Por favor, complete fecha y hora de recogida.");
         // return;
      }

      const numeroOrden = generarOrden();
      const formDataToSubmit = new FormData(form); 
      formDataToSubmit.append('NumeroOrden', numeroOrden);
      formDataToSubmit.append('Idioma', idiomaSelect.value || 'es');
      
      // Para el resumen local
      const pedidoParaResumenLocal = {};
      new FormData(form).forEach((value, key) => {
        if (pedidoParaResumenLocal[key]) {
          if (!Array.isArray(pedidoParaResumenLocal[key])) {
            pedidoParaResumenLocal[key] = [pedidoParaResumenLocal[key]];
          }
          pedidoParaResumenLocal[key].push(value);
        } else {
          pedidoParaResumenLocal[key] = value;
        }
      });
       // Correcci√≥n para obtener texto de rellenos para el resumen
      if (Array.isArray(pedidoParaResumenLocal.rellenos)) {
        const nombresRellenos = [];
        for (const valorRelleno of pedidoParaResumenLocal.rellenos) {
            const opt = rellenosSelect ? rellenosSelect.querySelector(`option[value="${valorRelleno}"]`) : null;
            if (opt) nombresRellenos.push(opt.textContent); else nombresRellenos.push(valorRelleno);
        }
        pedidoParaResumenLocal.rellenosTexto = nombresRellenos.join(', ');
      } else if (pedidoParaResumenLocal.rellenos) {
        const opt = rellenosSelect ? rellenosSelect.querySelector(`option[value="${pedidoParaResumenLocal.rellenos}"]`) : null;
        pedidoParaResumenLocal.rellenosTexto = opt ? opt.textContent : pedidoParaResumenLocal.rellenos;
      } else {
        pedidoParaResumenLocal.rellenosTexto = '';
      }


      let resumen = `${T.resumenTipo} ${pedidoParaResumenLocal.modelo || pedidoParaResumenLocal.forma || T.resumenDecoracionDefault}\n`;
      resumen += `${T.resumenFecha} ${pedidoParaResumenLocal.fechaRecogida} ${T.resumenHoraConector} ${pedidoParaResumenLocal.hora}\n`;
      resumen += `${T.resumenEntrega} ${pedidoParaResumenLocal.entrega}`;
      if (pedidoParaResumenLocal.entrega === 'Domicilio' && pedidoParaResumenLocal.direccion) {
        resumen += ` ${T.resumenEntregaDomicilioConector} ${pedidoParaResumenLocal.direccion}`;
      }
      resumen += `\n${T.resumenDecoracion} ${pedidoParaResumenLocal.decoracion || T.resumenDecoracionDefault}\n`;
      resumen += `${T.resumenMensaje} ${pedidoParaResumenLocal.mensajePastel || T.resumenMensajeDefault}\n`;
      resumen += `${T.resumenCliente} ${pedidoParaResumenLocal.nombre} (${pedidoParaResumenLocal.telefono})\n`; 

const metodoSeleccionado = document.querySelector('input[name="metodoContacto"]:checked')?.value || '';
const metodoContactoTexto = metodoSeleccionado === 'whatsapp'
  ? (T.optionContactoWhatsapp || 'WhatsApp')
  : (T.optionContactoCorreo || 'Correo Electr√≥nico');
  resumen += `${T.resumenMetodoContacto} ${metodoContactoTexto}`;

      
  
      fetch('https://script.google.com/macros/s/AKfycbxhMJmPJG8_Lkcn5yMdEW9_sldAHcWgNmt6OugicspTbY9WaJZlj7A35x4YZDi6MGq34g/exec', {
        method: 'POST',
        body: formDataToSubmit
      })
      .then(response => response.json()) 
      .then(result => {
        if (result.status === "success") {
          console.log("Respuesta del Apps Script:", result);
          let mensajeConfirmacionEspecifico = T.alertConfirmacionWhatsApp; 
          if (pedidoParaResumenLocal.metodoContacto === 'correo') { 
            mensajeConfirmacionEspecifico = T.alertConfirmacionCorreo || "‚úÖ Te confirmaremos por correo electr√≥nico en breve.";
          }
          alert(`${T.alertPedidoExito}\n${T.alertNumeroOrden}${numeroOrden}\n${T.alertTuPedidoEs}\n${resumen}\n${mensajeConfirmacionEspecifico}`);

          const mensajeWhatsApp = `${T.whatsappHolaPedidoWeb}%0A${T.whatsappMiNumeroOrdenEs} *${numeroOrden}*%0A${T.whatsappMiPedidoEs}%0A${resumen.replace(/\n/g, '%0A')}%0A${T.whatsappPorFavorConfirmen}`;
          const telefonoWhatsApp = '573027697351';
          window.open(`https://wa.me/${telefonoWhatsApp}?text=${mensajeWhatsApp}`, '_blank');

          form.reset();
          if (preview) {
              preview.src = '';
              preview.style.display = 'none';
          }
          if (direccionSection) direccionSection.style.display = 'none';
          if (modeloSelect) modeloSelect.dispatchEvent(new Event('change')); 
          if (rellenosSelect) rellenosSelect.dispatchEvent(new Event('change'));
        } else {
          console.error("Error del Apps Script:", result.message, result.details || '');
          alert(T.alertErrorPedido + (result.message ? `\nDetalle: ${result.message}` : ''));
        }
      })
      .catch(error => {
        console.error("Error en fetch:", error);
        alert(T.alertErrorPedido);
      });
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM completamente cargado y procesado."); 

    const campoFechaPedido = document.getElementById('fecha');
    if (campoFechaPedido) {
      const hoy = new Date();
      const anio = hoy.getFullYear();
      const mes = String(hoy.getMonth() + 1).padStart(2, '0'); 
      const dia = String(hoy.getDate()).padStart(2, '0');
      const fechaFormateada = `${anio}-${mes}-${dia}`;
      campoFechaPedido.value = fechaFormateada;
      campoFechaPedido.readOnly = true;
    }

    if (idiomaSelect) { // Asegurarse que idiomaSelect existe
        cambiarIdioma(idiomaSelect.value || 'es');
    }
    
    formaSelect = document.getElementById('forma'); 
    infoTamanoPastelDiv = document.getElementById('infoTamanoPastel'); 

    console.log("formaSelect encontrado (DOMContentLoaded):", formaSelect); 
    console.log("infoTamanoPastelDiv encontrado (DOMContentLoaded):", infoTamanoPastelDiv); 
    
    if (formaSelect && infoTamanoPastelDiv) { 
      console.log("Adjuntando listener a formaSelect (DOMContentLoaded)."); 
      formaSelect.addEventListener('change', function() {
        console.log("Forma select cambi√≥. Valor:", this.value); 
        const currentLang = idiomaSelect ? (idiomaSelect.value || 'es') : 'es';
        const T = translations[currentLang] || translations.es;
        // console.log("Idioma actual:", currentLang, "Traducci√≥n para infoCircular8:", T.infoCircular8); 

        if (this.value === 'Circular 8"') {
          // console.log("Condici√≥n Circular 8\" CUMPLIDA"); 
          infoTamanoPastelDiv.innerHTML = T.infoCircular8 || "Mensaje no disponible (fallback).";
          infoTamanoPastelDiv.style.display = 'block';
          // console.log("Mensaje DIV display:", infoTamanoPastelDiv.style.display, "HTML:", infoTamanoPastelDiv.innerHTML); 
        } else {
          // console.log("Condici√≥n Circular 8\" NO CUMPLIDA, ocultando mensaje."); 
          infoTamanoPastelDiv.style.display = 'none';
          infoTamanoPastelDiv.innerHTML = '';
        }
      });
      formaSelect.dispatchEvent(new Event('change')); 
    } else {
      console.error("Error: No se pudo encontrar formaSelect o infoTamanoPastelDiv en DOMContentLoaded.");
    }

    if (modeloSelect) modeloSelect.dispatchEvent(new Event('change'));
    if (rellenosSelect) rellenosSelect.dispatchEvent(new Event('change'));
    if (entregaSelect) entregaSelect.dispatchEvent(new Event('change'));
    
  });

</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S67VHFS5MK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
 gtag('config', 'G-S67VHFS5MK');
</script>
    
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const btnEnviar = document.getElementById('btnEnviar');

    if (btnEnviar) {
      btnEnviar.addEventListener('click', function () {
        gtag('event', 'enviar_pedido', {
          'event_category': 'Formulario',
          'event_label': 'Bot√≥n Enviar Pedido',
          'value': 1
        });
      });
    }
  });
</script>

    
</body>
</html>
